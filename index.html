
</html><!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>누적 계좌내역 완전 분석 시스템</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f7fa; line-height: 1.6; }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 30px; 
        }
        .header h1 { margin-bottom: 10px; }
        .header-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .header-stat { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; }
        .header-stat-number { font-size: 1.5em; font-weight: bold; }
        .header-stat-label { font-size: 0.9em; opacity: 0.9; }
        
        .upload-section { 
            background: white; padding: 25px; border-radius: 15px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 25px; 
        }
        .file-drop { 
            border: 2px dashed #d1d5db; border-radius: 10px; padding: 40px 20px; 
            text-align: center; cursor: pointer; transition: all 0.2s; 
        }
        .file-drop:hover { border-color: #2563eb; background: #f8fafc; }
        .file-drop.active { border-color: #059669; background: #f0fdf4; }
        .file-input { display: none; }
        
        .tabs {
            display: flex; background: white; border-radius: 15px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 25px; overflow: hidden;
        }
        .tab {
            padding: 15px 20px; background: #f9fafb; border: none; 
            cursor: pointer; font-weight: 500; flex: 1; transition: all 0.2s;
        }
        .tab.active { background: #2563eb; color: white; }
        .tab:hover:not(.active) { background: #e5e7eb; }
        
        .content-section { 
            background: white; border-radius: 15px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 20px;
        }
        .section-header { 
            background: #f8fafc; padding: 20px; border-bottom: 1px solid #e5e7eb; 
            display: flex; justify-content: space-between; align-items: center; 
        }
        .section-title { font-size: 1.3em; font-weight: bold; color: #1f2937; }
        .section-body { padding: 20px; }
        
        .summary-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 20px; margin-bottom: 25px; 
        }
        .summary-card { 
            background: #f9fafb; padding: 20px; border-radius: 15px; 
            border-left: 4px solid #2563eb; 
        }
        .summary-title { font-weight: bold; color: #1f2937; margin-bottom: 8px; }
        .summary-value { color: #2563eb; font-size: 1.3em; font-weight: 600; margin-bottom: 5px; }
        .summary-detail { font-size: 0.9em; color: #6b7280; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 8px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        th { 
            background: #f9fafb; font-weight: 600; color: #374151; 
            position: sticky; top: 0; z-index: 10;
        }
        td { font-size: 14px; }
        
        .amount-positive { color: #059669; font-weight: 600; }
        .amount-negative { color: #dc2626; font-weight: 600; }
        .amount-large { color: #7c3aed; font-weight: bold; }
        
        .customer-row { cursor: pointer; transition: background 0.2s; }
        .customer-row:hover { background: #f9fafb; }
        .customer-row.expanded { background: #f0fdf4; }
        
        .detail-row { 
            background: #f8fafc; font-size: 0.9em; 
            border-left: 3px solid #2563eb; 
        }
        .detail-row td { padding: 8px 12px; }
        
        .status-badge { 
            padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 600; 
        }
        .status-unreturned { background: #fef2f2; color: #dc2626; }
        .status-returned { background: #f0fdf4; color: #059669; }
        .status-excluded { background: #fef3c7; color: #d97706; }
        .status-new { background: #ede9fe; color: #7c3aed; }
        .status-sales { background: #dbeafe; color: #2563eb; }
        .status-deposit { background: #fef3c7; color: #d97706; }
        
        .btn { 
            background: #2563eb; color: white; padding: 12px 24px; 
            border: none; border-radius: 8px; cursor: pointer; 
            font-weight: 500; transition: all 0.2s; margin: 0 5px;
        }
        .btn:hover { background: #1d4ed8; }
        .btn-secondary { background: #6b7280; }
        .btn-secondary:hover { background: #4b5563; }
        
        .search-filter {
            display: flex; gap: 15px; margin-bottom: 20px; align-items: center;
        }
        .search-input {
            padding: 10px 15px; border: 1px solid #d1d5db; border-radius: 8px; 
            font-size: 14px; flex: 1; max-width: 300px;
        }
        
        .notification { 
            position: fixed; top: 20px; right: 20px; background: #059669; 
            color: white; padding: 15px 20px; border-radius: 8px; z-index: 1000; 
            transform: translateX(300px); transition: transform 0.3s ease; 
        }
        .notification.show { transform: translateX(0); }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .progress-bar {
            background: #e5e7eb; height: 4px; border-radius: 2px; overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            background: #2563eb; height: 100%; transition: width 0.3s ease;
        }
        
        .transaction-type-income { background: #f0fdf4; }
        .transaction-type-outcome { background: #fef2f2; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 누적 계좌내역 완전 분석 시스템</h1>
            <p>전체 계좌내역 누적 분석 • 매출/보증금/환급 완전 추적 • 상세 거래내역 확인</p>
            <div class="header-stats">
                <div class="header-stat">
                    <div class="header-stat-number" id="totalTransactions">0건</div>
                    <div class="header-stat-label">총 거래 건수</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-number" id="totalIncome">₩0</div>
                    <div class="header-stat-label">총 입금액</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-number" id="totalCustomers">0명</div>
                    <div class="header-stat-label">전체 고객 수</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-number" id="finalSalesAmount">₩0</div>
                    <div class="header-stat-label">최종 매출액</div>
                </div>
            </div>
        </div>

        <div class="upload-section">
            <div class="file-drop" id="fileDrop">
                <h3>📂 계좌내역 업로드 (누적 분석)</h3>
                <p>새로운 계좌내역을 업로드하면 기존 데이터에 추가로 누적됩니다</p>
                <div id="uploadStatus"></div>
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls">
            </div>
            <div style="display: flex; gap: 15px; margin-top: 20px; align-items: center;">
                <button onclick="analyzeData()" class="btn" id="analyzeBtn" disabled>🔍 전체 데이터 분석</button>
                <button onclick="clearData()" class="btn btn-secondary">🗑️ 데이터 초기화</button>
                <button onclick="exportData()" class="btn btn-secondary">📊 분석 결과 내보내기</button>
                <div id="processStatus" style="flex: 1; text-align: right;"></div>
            </div>
            <div class="progress-bar" id="progressContainer" style="display: none;">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">📊 전체 현황</button>
            <button class="tab" onclick="showTab('customers')">👥 고객별 분석</button>
            <button class="tab" onclick="showTab('deposits')">💰 보증금 관리</button>
            <button class="tab" onclick="showTab('sales')">📈 매출 분석</button>
            <button class="tab" onclick="showTab('monthly')">📅 월별 분석</button>
            <button class="tab" onclick="showTab('transactions')">📋 전체 거래</button>
        </div>

        <!-- 전체 현황 탭 -->
        <div id="overview" class="content-section tab-content active">
            <div class="section-header">
                <div class="section-title">📊 전체 현황 요약</div>
            </div>
            <div class="section-body">
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-title">💰 총 보증금</div>
                        <div class="summary-value" id="overviewTotalDeposits">₩0</div>
                        <div class="summary-detail" id="overviewDepositDetail">미환급 + 환급완료</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">📈 총 매출</div>
                        <div class="summary-value" id="overviewTotalSales">₩0</div>
                        <div class="summary-detail" id="overviewSalesDetail">보증금 제외 순수 매출</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">🚫 매출 제외</div>
                        <div class="summary-value" id="overviewExcludedAmount">₩0</div>
                        <div class="summary-detail" id="overviewExcludedDetail">황승하, SENTBE 등</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">👥 전체 고객</div>
                        <div class="summary-value" id="overviewTotalCustomerCount">0명</div>
                        <div class="summary-detail" id="overviewCustomerDetail">입금 고객 기준</div>
                    </div>
                </div>

                <div id="recentUploads" style="margin-top: 30px;">
                    <h4 style="margin-bottom: 15px;">📂 업로드된 파일 현황</h4>
                    <div id="uploadHistory"></div>
                </div>
            </div>
        </div>

        <!-- 고객별 분석 탭 -->
        <div id="customers" class="content-section tab-content">
            <div class="section-header">
                <div class="section-title">👥 고객별 상세 분석</div>
                <div class="search-filter">
                    <input type="text" id="customerSearch" class="search-input" placeholder="고객명 검색...">
                    <select id="customerFilter" class="search-input" style="max-width: 200px;">
                        <option value="all">전체</option>
                        <option value="deposit">보증금 고객</option>
                        <option value="sales">매출만</option>
                        <option value="large">대량거래 (1000만+)</option>
                        <option value="excluded">제외 고객</option>
                    </select>
                </div>
            </div>
            <div class="section-body">
                <table id="customersTable">
                    <thead>
                        <tr>
                            <th>고객명</th>
                            <th>총 입금액</th>
                            <th>보증금</th>
                            <th>매출</th>
                            <th>거래건수</th>
                            <th>거래기간</th>
                            <th>상태</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- 보증금 관리 탭 -->
        <div id="deposits" class="content-section tab-content">
            <div class="section-header">
                <div class="section-title">💰 보증금 상세 관리</div>
            </div>
            <div class="section-body">
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-title">🔴 미환급 보증금</div>
                        <div class="summary-value" id="unreturnedDepositAmount">₩0</div>
                        <div class="summary-detail" id="unreturnedDepositCount">0명 고객</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">✅ 환급완료 보증금</div>
                        <div class="summary-value" id="returnedDepositAmount">₩0</div>
                        <div class="summary-detail" id="returnedDepositCount">0명 고객</div>
                    </div>
                </div>
                
                <table id="depositsTable">
                    <thead>
                        <tr>
                            <th>고객명</th>
                            <th>보증금액</th>
                            <th>입금일</th>
                            <th>환급상태</th>
                            <th>환급일</th>
                            <th>연결매출</th>
                            <th>비고</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- 매출 분석 탭 -->
        <div id="sales" class="content-section tab-content">
            <div class="section-header">
                <div class="section-title">📈 매출 상세 분석</div>
                <div class="search-filter">
                    <input type="text" id="salesSearch" class="search-input" placeholder="고객명 검색...">
                    <select id="salesFilter" class="search-input" style="max-width: 200px;">
                        <option value="all">전체</option>
                        <option value="pure">순수 매출</option>
                        <option value="deposit-linked">보증금 연결</option>
                        <option value="large">대량 거래</option>
                    </select>
                </div>
            </div>
            <div class="section-body">
                <table id="salesTable">
                    <thead>
                        <tr>
                            <th>고객명</th>
                            <th>매출액</th>
                            <th>거래건수</th>
                            <th>거래기간</th>
                            <th>구분</th>
                            <th>보증금</th>
                            <th>상세보기</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- 월별 분석 탭 -->
        <div id="monthly" class="content-section tab-content">
            <div class="section-header">
                <div class="section-title">📅 월별 거래 현황</div>
            </div>
            <div class="section-body">
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-title">📊 월별 거래 기준</div>
                        <div class="summary-value">매출 거래만</div>
                        <div class="summary-detail">보증금, 환급, 제외항목 제외한 순수 매출 거래</div>
                    </div>
                </div>
                
                <table id="monthlyTable">
                    <thead>
                        <tr>
                            <th>년월</th>
                            <th>매출 거래건수</th>
                            <th>매출액</th>
                            <th>신규고객</th>
                            <th>평균거래액</th>
                            <th>전월대비</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- 전체 거래 탭 -->
        <div id="transactions" class="content-section tab-content">
            <div class="section-header">
                <div class="section-title">📋 전체 거래 내역</div>
                <div class="search-filter">
                    <input type="text" id="transactionSearch" class="search-input" placeholder="고객명/날짜 검색...">
                    <select id="transactionFilter" class="search-input" style="max-width: 200px;">
                        <option value="all">전체</option>
                        <option value="income">입금만</option>
                        <option value="outcome">출금만</option>
                        <option value="large">100만원 이상</option>
                        <option value="recent">최근 30일</option>
                    </select>
                </div>
            </div>
            <div class="section-body">
                <table id="transactionsTable">
                    <thead>
                        <tr>
                            <th>날짜</th>
                            <th>고객명</th>
                            <th>입금액</th>
                            <th>출금액</th>
                            <th>분류</th>
                            <th>비고</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // 전역 데이터 저장소
        let allTransactions = [];
        let allCustomers = {};
        let uploadHistory = [];
        let analysisComplete = false;

        // 제외 고객 및 특별 처리 규칙
        const excludeCustomers = ['황승하', '황승하(쿨키즈클럽)', 'SENTBE', '이창훈', '국고환급:은평세무서', '주식회사필웨이'];
        const specialCases = {
            '채혁': { type: 'deposit_management', note: '예치금 형태 운영' },
            '테이밍랩': { type: 'full_refund', note: '전액 환불' }
        };

        // 로컬 스토리지 키
        const STORAGE_KEY = 'accountAnalysisData';

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            loadStoredData();
        });

        function initializeEventListeners() {
            const fileDrop = document.getElementById('fileDrop');
            const fileInput = document.getElementById('fileInput');
            
            fileDrop.addEventListener('click', () => fileInput.click());
            fileDrop.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileDrop.classList.add('active');
            });
            fileDrop.addEventListener('dragleave', () => {
                fileDrop.classList.remove('active');
            });
            fileDrop.addEventListener('drop', (e) => {
                e.preventDefault();
                fileDrop.classList.remove('active');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });

            // 검색 필터 이벤트
            ['customerSearch', 'customerFilter', 'salesSearch', 'salesFilter', 'transactionSearch', 'transactionFilter'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', () => filterTable(id));
                    element.addEventListener('change', () => filterTable(id));
                }
            });
        }

        function handleFile(file) {
            if (!file.name.match(/\.(xlsx|xls)$/)) {
                showNotification('❌ Excel 파일만 업로드 가능합니다!');
                return;
            }
            
            document.getElementById('uploadStatus').innerHTML = `
                <div style="color: #059669; margin-top: 10px;">
                    ✅ ${file.name} 선택됨 (${(file.size / 1024 / 1024).toFixed(2)}MB)
                </div>
            `;
            document.getElementById('analyzeBtn').disabled = false;
            window.uploadedFile = file;
            showNotification('📂 파일이 선택되었습니다. 분석 버튼을 클릭하세요!');
        }

        async function analyzeData() {
            if (!window.uploadedFile) {
                showNotification('❌ 먼저 파일을 업로드하세요!');
                return;
            }

            try {
                showProgress(10, '파일 읽는 중...');
                
                const reader = new FileReader();
                reader.onload = async function(e) {
                    try {
                        showProgress(30, '데이터 파싱 중...');
                        
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, {type: 'array'});
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                        
                        showProgress(50, '거래 내역 분석 중...');
                        
                        const newTransactions = parseTransactionData(jsonData);
                        
                        showProgress(70, '중복 제거 및 데이터 통합 중...');
                        
                        const beforeCount = allTransactions.length;
                        integrateTransactions(newTransactions);
                        const addedCount = allTransactions.length - beforeCount;
                        
                        showProgress(85, '고객별 데이터 분석 중...');
                        
                        analyzeCustomerData();
                        
                        showProgress(100, '분석 완료!');
                        
                        uploadHistory.push({
                            fileName: window.uploadedFile.name,
                            uploadTime: new Date(),
                            transactionCount: newTransactions.length,
                            addedCount: addedCount
                        });
                        
                        saveData();
                        updateAllTabs();
                        
                        analysisComplete = true;
                        showNotification(`✅ 분석 완료! ${addedCount}건의 새로운 거래가 추가되었습니다.`);
                        hideProgress();
                        
                    } catch (error) {
                        console.error('분석 오류:', error);
                        showNotification('❌ 파일 분석 중 오류가 발생했습니다.');
                        hideProgress();
                    }
                };
                
                reader.readAsArrayBuffer(window.uploadedFile);
                
            } catch (error) {
                console.error('파일 읽기 오류:', error);
                showNotification('❌ 파일을 읽을 수 없습니다.');
                hideProgress();
            }
        }

        function parseTransactionData(jsonData) {
            const transactionData = jsonData.slice(7).filter(row => row && row.length > 5);
            
            return transactionData.map((row, index) => {
                const dateStr = row[1];
                const customer = row[2];
                const outAmount = parseFloat(row[3]) || 0;
                const inAmount = parseFloat(row[4]) || 0;
                
                let parsedDate = null;
                if (dateStr && typeof dateStr === 'string') {
                    const dateMatch = dateStr.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                    if (dateMatch) {
                        parsedDate = new Date(dateMatch[1], dateMatch[2] - 1, dateMatch[3]);
                    }
                }
                
                const uniqueId = `${dateStr}_${customer}_${inAmount}_${outAmount}_${index}`;
                
                return {
                    id: uniqueId,
                    date: dateStr,
                    parsedDate: parsedDate,
                    customer: customer,
                    outAmount: outAmount,
                    inAmount: inAmount,
                    type: inAmount > 0 ? '입금' : '출금',
                    excluded: excludeCustomers.some(exclude => customer && customer.includes(exclude))
                };
            }).filter(t => t.parsedDate && t.customer);
        }

        function integrateTransactions(newTransactions) {
            const existingIds = new Set(allTransactions.map(t => t.id));
            
            newTransactions.forEach(transaction => {
                if (!existingIds.has(transaction.id)) {
                    allTransactions.push(transaction);
                }
            });
            
            allTransactions.sort((a, b) => b.parsedDate - a.parsedDate);
        }

        function analyzeCustomerData() {
            allCustomers = {};
            
            allTransactions.forEach(transaction => {
                const customer = transaction.customer;
                
                if (!allCustomers[customer]) {
                    allCustomers[customer] = {
                        name: customer,
                        transactions: [],
                        totalIncome: 0,
                        totalOutcome: 0,
                        salesAmount: 0,
                        depositAmount: 0,
                        depositStatus: 'none',
                        depositDate: null,
                        returnDate: null,
                        firstTransactionDate: null,
                        lastTransactionDate: null,
                        excluded: excludeCustomers.some(exclude => customer.includes(exclude))
                    };
                }
                
                const customerData = allCustomers[customer];
                customerData.transactions.push(transaction);
                
                if (transaction.type === '입금') {
                    customerData.totalIncome += transaction.inAmount;
                } else {
                    customerData.totalOutcome += transaction.outAmount;
                }
                
                if (!customerData.firstTransactionDate || transaction.parsedDate < customerData.firstTransactionDate) {
                    customerData.firstTransactionDate = transaction.parsedDate;
                }
                if (!customerData.lastTransactionDate || transaction.parsedDate > customerData.lastTransactionDate) {
                    customerData.lastTransactionDate = transaction.parsedDate;
                }
            });
            
            Object.values(allCustomers).forEach(customer => {
                if (customer.excluded) {
                    return;
                }
                
                const incomeTransactions = customer.transactions
                    .filter(t => t.type === '입금')
                    .sort((a, b) => a.parsedDate - b.parsedDate);
                
                if (incomeTransactions.length === 0) return;const firstTransaction = incomeTransactions[0];
                if (firstTransaction.inAmount >= 1000000) {
                    customer.depositAmount = firstTransaction.inAmount;
                    customer.depositDate = firstTransaction.date;
                    customer.depositStatus = 'unreturned';
                    
                    customer.salesAmount = customer.totalIncome - customer.depositAmount;
                    
                    const outcomeTransactions = customer.transactions.filter(t => t.type === '출금');
                    const refundTransaction = outcomeTransactions.find(t => 
                        Math.abs(t.outAmount - customer.depositAmount) < 50000
                    );
                    
                    if (refundTransaction) {
                        customer.depositStatus = 'returned';
                        customer.returnDate = refundTransaction.date;
                    }
                } else {
                    customer.salesAmount = customer.totalIncome;
                }
                
                if (specialCases[customer.name]) {
                    const specialCase = specialCases[customer.name];
                    if (specialCase.type === 'full_refund') {
                        customer.salesAmount = 0;
                    } else if (specialCase.type === 'deposit_management') {
                        customer.salesAmount = customer.totalIncome - customer.totalOutcome;
                    }
                }
            });
        }

        function updateAllTabs() {
            updateHeaderStats();
            updateOverviewTab();
            updateCustomersTab();
            updateDepositsTab();
            updateSalesTab();
            updateMonthlyTab();
            updateTransactionsTab();
        }

        function updateHeaderStats() {
            const incomeTransactions = allTransactions.filter(t => t.type === '입금' && !t.excluded);
            const totalIncome = incomeTransactions.reduce((sum, t) => sum + t.inAmount, 0);
            const totalCustomers = Object.keys(allCustomers).filter(name => !allCustomers[name].excluded).length;
            
            const totalSales = Object.values(allCustomers)
                .filter(c => !c.excluded)
                .reduce((sum, c) => sum + c.salesAmount, 0);
            
            document.getElementById('totalTransactions').textContent = allTransactions.length.toLocaleString() + '건';
            document.getElementById('totalIncome').textContent = '₩' + totalIncome.toLocaleString();
            document.getElementById('totalCustomers').textContent = totalCustomers + '명';
            document.getElementById('finalSalesAmount').textContent = '₩' + totalSales.toLocaleString();
        }

        function updateOverviewTab() {
            const nonExcludedCustomers = Object.values(allCustomers).filter(c => !c.excluded);
            
            const totalDeposits = nonExcludedCustomers.reduce((sum, c) => sum + c.depositAmount, 0);
            const totalSales = nonExcludedCustomers.reduce((sum, c) => sum + c.salesAmount, 0);
            const excludedAmount = Object.values(allCustomers)
                .filter(c => c.excluded)
                .reduce((sum, c) => sum + c.totalIncome, 0);
            
            document.getElementById('overviewTotalDeposits').textContent = '₩' + totalDeposits.toLocaleString();
            document.getElementById('overviewTotalSales').textContent = '₩' + totalSales.toLocaleString();
            document.getElementById('overviewExcludedAmount').textContent = '₩' + excludedAmount.toLocaleString();
            document.getElementById('overviewTotalCustomerCount').textContent = nonExcludedCustomers.length + '명';
            
            const depositCustomers = nonExcludedCustomers.filter(c => c.depositAmount > 0);
            document.getElementById('overviewDepositDetail').textContent = `보증금 고객 ${depositCustomers.length}명`;
            document.getElementById('overviewSalesDetail').textContent = `매출 고객 ${nonExcludedCustomers.filter(c => c.salesAmount > 0).length}명`;
            document.getElementById('overviewExcludedDetail').textContent = `제외 고객 ${Object.values(allCustomers).filter(c => c.excluded).length}명`;
            document.getElementById('overviewCustomerDetail').textContent = `전체 ${Object.keys(allCustomers).length}명 중 유효 고객`;
            
            updateUploadHistory();
        }

        function updateUploadHistory() {
            const historyContainer = document.getElementById('uploadHistory');
            if (uploadHistory.length === 0) {
                historyContainer.innerHTML = '<p style="color: #6b7280;">아직 업로드된 파일이 없습니다.</p>';
                return;
            }
            
            const historyHTML = uploadHistory.map((upload, index) => `
                <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${upload.fileName}</strong>
                            <span style="color: #6b7280; margin-left: 10px;">
                                ${upload.uploadTime.toLocaleString()}
                            </span>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: #059669;">+${upload.addedCount}건 추가</div>
                            <div style="font-size: 0.9em; color: #6b7280;">총 ${upload.transactionCount}건</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            historyContainer.innerHTML = historyHTML;
        }

        function updateCustomersTab() {
            const tbody = document.querySelector('#customersTable tbody');
            tbody.innerHTML = '';
            
            const sortedCustomers = Object.values(allCustomers)
                .sort((a, b) => b.totalIncome - a.totalIncome);
            
            sortedCustomers.forEach(customer => {
                const row = tbody.insertRow();
                row.className = 'customer-row';
                row.setAttribute('data-customer', customer.name);
                
                const period = customer.firstTransactionDate && customer.lastTransactionDate ? 
                    `${customer.firstTransactionDate.toLocaleDateString()} ~ ${customer.lastTransactionDate.toLocaleDateString()}` : 
                    '-';
                
                let statusBadge = '';
                if (customer.excluded) {
                    statusBadge = '<span class="status-badge status-excluded">제외</span>';
                } else if (customer.depositAmount > 0) {
                    if (customer.depositStatus === 'returned') {
                        statusBadge = '<span class="status-badge status-returned">환급완료</span>';
                    } else {
                        statusBadge = '<span class="status-badge status-unreturned">미환급</span>';
                    }
                } else {
                    statusBadge = '<span class="status-badge status-sales">매출만</span>';
                }
                
                row.innerHTML = `
                    <td><strong>${customer.name}</strong></td>
                    <td class="amount-large">₩${customer.totalIncome.toLocaleString()}</td>
                    <td class="amount-negative">₩${customer.depositAmount.toLocaleString()}</td>
                    <td class="amount-positive">₩${customer.salesAmount.toLocaleString()}</td>
                    <td>${customer.transactions.filter(t => t.type === '입금').length}건</td>
                    <td style="font-size: 0.9em;">${period}</td>
                    <td>${statusBadge}</td>
                `;
                
                row.addEventListener('click', () => toggleCustomerDetails(customer.name, row));
            });
        }

        function toggleCustomerDetails(customerName, row) {
            const customer = allCustomers[customerName];
            const existingDetailRow = row.nextElementSibling;
            
            if (existingDetailRow && existingDetailRow.classList.contains('detail-row')) {
                existingDetailRow.remove();
                row.classList.remove('expanded');
                return;
            }
            
            const detailRow = row.parentNode.insertRow(row.rowIndex + 1);
            detailRow.className = 'detail-row';
            detailRow.innerHTML = `
                <td colspan="7">
                    <div style="padding: 15px;">
                        <h5 style="margin-bottom: 10px;">${customerName} 상세 거래 내역</h5>
                        <table style="width: 100%; font-size: 0.9em;">
                            <thead>
                                <tr>
                                    <th>날짜</th>
                                    <th>유형</th>
                                    <th>금액</th>
                                    <th>분류</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${customer.transactions.map(t => {
                                    let classification = '';
                                    let note = '';
                                    
                                    if (t.type === '입금') {
                                        if (customer.depositAmount > 0 && t.inAmount === customer.depositAmount && t.date === customer.depositDate) {
                                            classification = '<span class="status-badge status-deposit">보증금</span>';
                                            note = '첫 입금 (보증금)';
                                        } else {
                                            classification = '<span class="status-badge status-sales">매출</span>';
                                            note = '매출 입금';
                                        }
                                    } else {
                                        if (customer.returnDate && t.date === customer.returnDate) {
                                            classification = '<span class="status-badge status-returned">환급</span>';
                                            note = '보증금 환급';
                                        } else {
                                            classification = '<span class="status-badge">출금</span>';
                                            note = '일반 출금';
                                        }
                                    }
                                    
                                    return `
                                        <tr class="transaction-type-${t.type === '입금' ? 'income' : 'outcome'}">
                                            <td>${t.date.substring(0, 10)}</td>
                                            <td>${t.type}</td>
                                            <td class="amount-${t.type === '입금' ? 'positive' : 'negative'}">₩${(t.inAmount || t.outAmount).toLocaleString()}</td>
                                            <td>${classification}</td>
                                            <td>${note}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </td>
            `;
            
            row.classList.add('expanded');
        }

        function updateDepositsTab() {
            const tbody = document.querySelector('#depositsTable tbody');
            tbody.innerHTML = '';
            
            const depositCustomers = Object.values(allCustomers).filter(c => c.depositAmount > 0);
            let unreturnedAmount = 0;
            let returnedAmount = 0;
            let unreturnedCount = 0;
            let returnedCount = 0;
            
            depositCustomers.forEach(customer => {
                const row = tbody.insertRow();
                
                let statusBadge, returnDateText;
                if (customer.depositStatus === 'returned') {
                    statusBadge = '<span class="status-badge status-returned">환급완료</span>';
                    returnDateText = customer.returnDate ? customer.returnDate.substring(0, 10) : '-';
                    returnedAmount += customer.depositAmount;
                    returnedCount++;
                } else {
                    statusBadge = '<span class="status-badge status-unreturned">미환급</span>';
                    returnDateText = '-';
                    unreturnedAmount += customer.depositAmount;
                    unreturnedCount++;
                }
                
                row.innerHTML = `
                    <td><strong>${customer.name}</strong></td>
                    <td class="amount-negative">₩${customer.depositAmount.toLocaleString()}</td>
                    <td>${customer.depositDate ? customer.depositDate.substring(0, 10) : '-'}</td>
                    <td>${statusBadge}</td>
                    <td>${returnDateText}</td>
                    <td class="amount-positive">₩${customer.salesAmount.toLocaleString()}</td>
                    <td>${specialCases[customer.name]?.note || '일반 보증금'}</td>
                `;
            });
            
            document.getElementById('unreturnedDepositAmount').textContent = '₩' + unreturnedAmount.toLocaleString();
            document.getElementById('returnedDepositAmount').textContent = '₩' + returnedAmount.toLocaleString();
            document.getElementById('unreturnedDepositCount').textContent = unreturnedCount + '명 고객';
            document.getElementById('returnedDepositCount').textContent = returnedCount + '명 고객';
        }

        function updateSalesTab() {
            const tbody = document.querySelector('#salesTable tbody');
            tbody.innerHTML = '';
            
            const salesCustomers = Object.values(allCustomers)
                .filter(c => !c.excluded && c.salesAmount > 0)
                .sort((a, b) => b.salesAmount - a.salesAmount);
            
            salesCustomers.forEach(customer => {
                const row = tbody.insertRow();
                row.className = 'customer-row';
                
                const period = customer.firstTransactionDate && customer.lastTransactionDate ? 
                    `${customer.firstTransactionDate.toLocaleDateString()} ~ ${customer.lastTransactionDate.toLocaleDateString()}` : 
                    '-';
                
                const incomeCount = customer.transactions.filter(t => t.type === '입금').length;
                
                let typeClass = customer.depositAmount > 0 ? 'deposit-linked' : 'pure';
                let typeBadge = customer.depositAmount > 0 ? 
                    '<span class="status-badge status-deposit">보증금연결</span>' : 
                    '<span class="status-badge status-sales">순수매출</span>';
                
                row.innerHTML = `
                    <td><strong>${customer.name}</strong></td>
                    <td class="amount-large">₩${customer.salesAmount.toLocaleString()}</td>
                    <td>${incomeCount}건</td>
                    <td style="font-size: 0.9em;">${period}</td>
                    <td>${typeBadge}</td>
                    <td>${customer.depositAmount > 0 ? '₩' + customer.depositAmount.toLocaleString() : '-'}</td>
                    <td><button class="btn" style="padding: 5px 10px; font-size: 0.8em;" onclick="showSalesDetails('${customer.name}')">상세보기</button></td>
                `;
                
                row.setAttribute('data-type', typeClass);
                row.setAttribute('data-customer', customer.name);
            });
        }

        function showSalesDetails(customerName) {
            const customer = allCustomers[customerName];
            const salesTransactions = customer.transactions.filter(t => t.type === '입금');
            
            let detailHTML = `
                <h4>${customerName} 매출 상세</h4>
                <p>총 매출: ₩${customer.salesAmount.toLocaleString()} (${salesTransactions.length}건)</p>
                <table style="width: 100%; margin-top: 15px;">
                    <thead>
                        <tr><th>날짜</th><th>금액</th><th>분류</th></tr>
                    </thead>
                    <tbody>
            `;
            
            salesTransactions.forEach(t => {
                const isDeposit = customer.depositAmount > 0 && t.inAmount === customer.depositAmount && t.date === customer.depositDate;
                detailHTML += `
                    <tr>
                        <td>${t.date.substring(0, 10)}</td>
                        <td class="amount-positive">₩${t.inAmount.toLocaleString()}</td>
                        <td>${isDeposit ? '<span class="status-badge status-deposit">보증금</span>' : '<span class="status-badge status-sales">매출</span>'}</td>
                    </tr>
                `;
            });
            
            detailHTML += '</tbody></table>';
            
            showNotification(`${customerName} 상세 정보를 콘솔에서 확인하세요.`);
            console.log(detailHTML);
        }

        function updateMonthlyTab() {
            const tbody = document.querySelector('#monthlyTable tbody');
            tbody.innerHTML = '';
            
            const salesTransactions = allTransactions.filter(t => {
                if (t.type !== '입금' || t.excluded) return false;
                
                const customer = allCustomers[t.customer];
                if (!customer) return false;
                
                if (customer.depositAmount > 0 && t.inAmount === customer.depositAmount && t.date === customer.depositDate) {
                    return false;
                }
                
                return true;
            });
            
            const monthlyData = {};
            const newCustomersByMonth = {};
            
            salesTransactions.forEach(t => {
                const yearMonth = `${t.parsedDate.getFullYear()}-${String(t.parsedDate.getMonth() + 1).padStart(2, '0')}`;
                
                if (!monthlyData[yearMonth]) {
                    monthlyData[yearMonth] = {
                        transactions: 0,
                        amount: 0,
                        customers: new Set()
                    };
                }
                
                monthlyData[yearMonth].transactions++;
                monthlyData[yearMonth].amount += t.inAmount;
                monthlyData[yearMonth].customers.add(t.customer);
                
                const customer = allCustomers[t.customer];
                if (customer && customer.firstTransactionDate && 
                    customer.firstTransactionDate.getFullYear() === t.parsedDate.getFullYear() &&
                    customer.firstTransactionDate.getMonth() === t.parsedDate.getMonth()) {
                    
                    if (!newCustomersByMonth[yearMonth]) {
                        newCustomersByMonth[yearMonth] = new Set();
                    }
                    newCustomersByMonth[yearMonth].add(t.customer);
                }
            });
            
            const sortedMonths = Object.keys(monthlyData).sort();
            let previousAmount = 0;
            
            sortedMonths.forEach(month => {
                const data = monthlyData[month];
                const newCustomers = newCustomersByMonth[month] ? newCustomersByMonth[month].size : 0;
                const avgAmount = data.transactions > 0 ? data.amount / data.transactions : 0;
                const growthRate = previousAmount > 0 ? ((data.amount - previousAmount) / previousAmount * 100).toFixed(1) : '0.0';
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${month}</strong></td>
                    <td>${data.transactions}건</td>
                    <td class="amount-positive">₩${data.amount.toLocaleString()}</td>
                    <td>${newCustomers}명</td>
                    <td>₩${avgAmount.toLocaleString()}</td>
                    <td style="color: ${parseFloat(growthRate) >= 0 ? '#059669' : '#dc2626'}">${growthRate > 0 ? '+' : ''}${growthRate}%</td>
                `;
                
                previousAmount = data.amount;
            });
        }

        function updateTransactionsTab() {
            const tbody = document.querySelector('#transactionsTable tbody');
            tbody.innerHTML = '';
            
            const recentTransactions = allTransactions.slice(0, 100);
            
            recentTransactions.forEach(t => {
                const row = tbody.insertRow();
                row.className = `transaction-type-${t.type === '입금' ? 'income' : 'outcome'}`;
                
                let classification = '';
                if (t.excluded) {
                    classification = '<span class="status-badge status-excluded">제외</span>';
                } else {
                    const customer = allCustomers[t.customer];
                    if (customer && t.type === '입금') {
                        if (customer.depositAmount > 0 && t.inAmount === customer.depositAmount && t.date === customer.depositDate) {
                            classification = '<span class="status-badge status-deposit">보증금</span>';
                        } else {
                            classification = '<span class="status-badge status-sales">매출</span>';
                        }
                    } else if (customer && t.type === '출금' && customer.returnDate && t.date === customer.returnDate) {
                        classification = '<span class="status-badge status-returned">환급</span>';
                    } else {
                        classification = '<span class="status-badge">일반</span>';
                    }
                }
                
                row.innerHTML = `
                    <td>${t.date.substring(0, 10)}</td>
                    <td><strong>${t.customer}</strong></td>
                    <td class="amount-positive">${t.type === '입금' ? '₩' + t.inAmount.toLocaleString() : '-'}</td>
                    <td class="amount-negative">${t.type === '출금' ? '₩' + t.outAmount.toLocaleString() : '-'}</td>
                    <td>${classification}</td>
                    <td style="font-size: 0.9em;">${t.type === '입금' ? '입금' : '출금'}</td>
                `;
                
                row.setAttribute('data-type', t.type);
                row.setAttribute('data-customer', t.customer);
                row.setAttribute('data-amount', t.inAmount || t.outAmount);
            });
        }

        function filterTable(filterId) {
            const searchTerm = document.getElementById(filterId)?.value.toLowerCase() || '';
            const filterValue = filterId.includes('Filter') ? searchTerm : 
                               document.getElementById(filterId.replace('Search', 'Filter'))?.value || 'all';
            
            if (filterId.includes('customer')) {
                filterCustomersTable(searchTerm, filterValue);
            } else if (filterId.includes('sales')) {
                filterSalesTable(searchTerm, filterValue);
            } else if (filterId.includes('transaction')) {
                filterTransactionsTable(searchTerm, filterValue);
            }
        }

        function filterCustomersTable(searchTerm, filterValue) {
            const rows = document.querySelectorAll('#customersTable tbody tr:not(.detail-row)');
            
            rows.forEach(row => {
                const customerName = row.cells[0].textContent.toLowerCase();
                const totalAmount = parseInt(row.cells[1].textContent.replace(/[₩,]/g, ''));
                const depositAmount = parseInt(row.cells[2].textContent.replace(/[₩,]/g, ''));
                const excluded = row.cells[6].textContent.includes('제외');
                
                let showRow = true;
                
                if (searchTerm && !customerName.includes(searchTerm)) {
                    showRow = false;
                }
                
                switch (filterValue) {
                    case 'deposit':
                        if (depositAmount === 0) showRow = false;
                        break;
                    case 'sales':
                        if (depositAmount > 0) showRow = false;
                        break;
                    case 'large':
                        if (totalAmount < 10000000) showRow = false;
                        break;
                    case 'excluded':
                        if (!excluded) showRow = false;
                        break;
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        function filterSalesTable(searchTerm, filterValue) {
            const rows = document.querySelectorAll('#salesTable tbody tr');
            
            rows.forEach(row => {
                const customerName = row.cells[0].textContent.toLowerCase();
                const salesAmount = parseInt(row.cells[1].textContent.replace(/[₩,]/g, ''));
                const type = row.getAttribute('data-type');
                
                let showRow = true;
                
                if (searchTerm && !customerName.includes(searchTerm)) {
                    showRow = false;
                }
                
                switch (filterValue) {
                    case 'pure':
                        if (type !== 'pure') showRow = false;
                        break;
                    case 'deposit-linked':
                        if (type !== 'deposit-linked') showRow = false;
                        break;
                    case 'large':
                        if (salesAmount < 5000000) showRow = false;
                        break;
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        function filterTransactionsTable(searchTerm, filterValue) {
            const rows = document.querySelectorAll('#transactionsTable tbody tr');
            
            rows.forEach(row => {
                const date = row.cells[0].textContent;
                const customerName = row.cells[1].textContent.toLowerCase();
                const type = row.getAttribute('data-type');
                const amount = parseInt(row.getAttribute('data-amount'));
                
                let showRow = true;
                
                if (searchTerm && !customerName.includes(searchTerm) && !date.includes(searchTerm)) {
                    showRow = false;
                }
                
                switch (filterValue) {
                    case 'income':
                        if (type !== '입금') showRow = false;
                        break;
                    case 'outcome':
                        if (type !== '출금') showRow = false;
                        break;
                    case 'large':
                        if (amount < 1000000) showRow = false;
                        break;
                    case 'recent':
                        const transactionDate = new Date(date);
                        const thirtyDaysAgo = new Date();
                        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                        if (transactionDate < thirtyDaysAgo) showRow = false;
                        break;
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function clearData() {
            if (confirm('정말로 모든 데이터를 초기화하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                allTransactions = [];
                allCustomers = {};
                uploadHistory = [];
                analysisComplete = false;
                
                localStorage.removeItem(STORAGE_KEY);
                
                updateAllTabs();
                document.getElementById('uploadStatus').innerHTML = '';
                document.getElementById('analyzeBtn').disabled = true;
                
                showNotification('✅ 모든 데이터가 초기화되었습니다.');
            }
        }

        function saveData() {
            const dataToSave = {
                transactions: allTransactions,
                customers: allCustomers,
                uploadHistory: uploadHistory,
                timestamp: new Date().toISOString()
            };
            
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            } catch (error) {
                console.warn('데이터 저장 실패:', error);
                showNotification('⚠️ 데이터가 너무 커서 저장하지 못했습니다.');
            }
        }

        function loadStoredData() {
            try {
                const storedData = localStorage.getItem(STORAGE_KEY);
                if (storedData) {
                    const data = JSON.parse(storedData);
                    
                    allTransactions = data.transactions || [];
                    allCustomers = data.customers || {};
                    uploadHistory = data.uploadHistory || [];
                    
                    allTransactions.forEach(t => {
                        if (t.parsedDate) {
                            t.parsedDate = new Date(t.parsedDate);
                        }
                    });
                    
                    Object.values(allCustomers).forEach(customer => {
                        if (customer.firstTransactionDate) {
                            customer.firstTransactionDate = new Date(customer.firstTransactionDate);
                        }
                        if (customer.lastTransactionDate) {
                            customer.lastTransactionDate = new Date(customer.lastTransactionDate);
                        }
                        if (customer.transactions) {
                            customer.transactions.forEach(t => {
                                if (t.parsedDate) {
                                    t.parsedDate = new Date(t.parsedDate);
                                }
                            });
                        }
                    });
                    
                    uploadHistory.forEach(upload => {
                        upload.uploadTime = new Date(upload.uploadTime);
                    });
                    
                    if (allTransactions.length > 0) {
                        analysisComplete = true;
                        updateAllTabs();
                        showNotification('💾 저장된 데이터를 불러왔습니다.');
                    }
                }
            } catch (error) {
                console.warn('저장된 데이터 로드 실패:', error);
                showNotification('⚠️ 저장된 데이터를 불러오지 못했습니다.');
            }
        }

        function exportData() {
            if (!analysisComplete || allTransactions.length === 0) {
                showNotification('❌ 먼저 데이터를 분석하세요!');
                return;
            }
            
            const nonExcludedCustomers = Object.values(allCustomers).filter(c => !c.excluded);
            const totalDeposits = nonExcludedCustomers.reduce((sum, c) => sum + c.depositAmount, 0);
            const totalSales = nonExcludedCustomers.reduce((sum, c) => sum + c.salesAmount, 0);
            const excludedAmount = Object.values(allCustomers).filter(c => c.excluded).reduce((sum, c) => sum + c.totalIncome, 0);
            
            const exportData = {
                timestamp: new Date().toISOString(),
                summary: {
                    totalTransactions: allTransactions.length,
                    totalCustomers: Object.keys(allCustomers).length,
                    totalIncome: allTransactions.filter(t => t.type === '입금').reduce((sum, t) => sum + t.inAmount, 0),
                    totalDeposits: totalDeposits,
                    excludedAmount: excludedAmount,
                    depositCustomers: nonExcludedCustomers.filter(c => c.depositAmount > 0).length,
                    unreturnedDeposits: nonExcludedCustomers.filter(c => c.depositStatus === 'unreturned').length,
                    returnedDeposits: nonExcludedCustomers.filter(c => c.depositStatus === 'returned').length
                },
                customers: allCustomers,
                uploadHistory: uploadHistory,
                topCustomers: nonExcludedCustomers
                    .sort((a, b) => b.totalIncome - a.totalIncome)
                    .slice(0, 20)
                    .map(c => ({
                        name: c.name,
                        totalIncome: c.totalIncome,
                        depositAmount: c.depositAmount,
                        salesAmount: c.salesAmount,
                        transactionCount: c.transactions.filter(t => t.type === '입금').length
                    }))
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `계좌내역_완전분석_${new Date().toISOString().substring(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('✅ 분석 결과가 내보내졌습니다!');
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 3000);
        }

        function showProgress(percentage, message) {
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('processStatus').textContent = message;
        }

        function hideProgress() {
            setTimeout(() => {
                document.getElementById('progressContainer').style.display = 'none';
                document.getElementById('processStatus').textContent = '';
            }, 1000);
        }
    </script>
</body>

              
