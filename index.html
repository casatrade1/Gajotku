<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í∞ÄÏ°∞Ïø† - ÏπúÍµ¨Îì§ÎßåÏùò SNS</title>
    
    <!-- Firebase SDK (Î≤ÑÏ†Ñ Ìò∏ÌôòÏÑ± ÏàòÏ†ï) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fafafa;
            color: #262626;
        }

        /* Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ */
        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: white;
            border: 1px solid #dbdbdb;
            border-radius: 12px;
            padding: 40px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .logo {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .friend-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .friend-card {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .friend-card:hover {
            border-color: #405de6;
            background: #f0f2ff;
        }

        .friend-card.selected {
            border-color: #405de6;
            background: #405de6;
            color: white;
        }

        .friend-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .friend-birthday {
            font-size: 12px;
            opacity: 0.7;
        }

        .login-btn {
            background: #405de6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
        }

        .login-btn:hover {
            background: #3449d1;
        }

        .login-btn:disabled {
            background: #c7c7c7;
            cursor: not-allowed;
        }

        /* Î©îÏù∏ Ïï± ÌôîÎ©¥ */
        .main-app {
            display: none;
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        /* ÏÉùÏùº ÏïåÎ¶º Îù† */
        .birthday-banner {
            background: #262626;
            color: white;
            padding: 8px 16px;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
        }

        /* Ìó§Îçî */
        .header {
            background: white;
            border-bottom: 1px solid #dbdbdb;
            padding: 10px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-title {
            font-size: 24px;
            font-weight: bold;
            font-family: 'Billabong', cursive;
        }

        .header-icons {
            display: flex;
            gap: 16px;
        }

        .icon-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
        }

        /* Ïä§ÌÜ†Î¶¨ ÏòÅÏó≠ */
        .stories-container {
            background: white;
            padding: 16px;
            border-bottom: 1px solid #dbdbdb;
            overflow-x: auto;
        }

        .stories-scroll {
            display: flex;
            gap: 16px;
            padding-bottom: 8px;
        }

        .story-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
            cursor: pointer;
        }

        .story-ring {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 4px;
            position: relative;
        }

        .story-ring.viewed {
            background: #c7c7c7;
        }

        .story-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: #405de6;
        }

        .story-username {
            font-size: 10px;
            text-align: center;
            max-width: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .story-badge {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        .story-badge.meeting {
            background: #e91e63;
            color: white;
        }

        .story-badge.diary {
            background: #4caf50;
            color: white;
        }

        /* ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: white;
            border-top: 1px solid #dbdbdb;
            display: flex;
            padding: 8px 0;
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            font-size: 24px;
            color: #262626;
            transition: all 0.2s;
        }

        .nav-item.active {
            color: #405de6;
        }

        /* Ïª®ÌÖêÏ∏† ÏòÅÏó≠ */
        .content {
            padding-bottom: 60px;
            min-height: calc(100vh - 100px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Ïù∏Ïä§ÌÉÄ Ìè¨Ïä§Ìä∏ Ïä§ÌÉÄÏùº */
        .post {
            background: white;
            border: 1px solid #dbdbdb;
            margin-bottom: 16px;
        }

        .post-header {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .post-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-pic {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #405de6, #5851db, #833ab4, #c13584);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .user-info h4 {
            font-size: 14px;
            font-weight: 600;
            margin: 0;
        }

        .post-time {
            font-size: 11px;
            color: #8e8e8e;
        }

        .post-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            display: block;
        }

        .post-actions {
            padding: 8px 16px;
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .action-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            color: #262626;
            transition: all 0.2s;
        }

        .action-btn.liked {
            color: #ed4956;
        }

        .post-likes {
            padding: 0 16px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .post-content {
            padding: 0 16px 12px;
            font-size: 14px;
            line-height: 1.4;
        }

        .post-content .username {
            font-weight: 600;
            margin-right: 8px;
        }

        /* Ìè¨Ïä§Ìä∏ ÏûëÏÑ± */
        .create-post {
            background: white;
            border: 1px solid #dbdbdb;
            margin: 16px;
            border-radius: 12px;
            padding: 16px;
        }

        .create-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .create-input {
            width: 100%;
            border: none;
            font-size: 14px;
            resize: none;
            outline: none;
            min-height: 60px;
            margin-bottom: 12px;
        }

        .create-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .attach-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #8e8e8e;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .post-btn {
            background: #405de6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .post-btn:disabled {
            background: #c7c7c7;
            cursor: not-allowed;
        }

        /* Ïù¥ÎØ∏ÏßÄ ÌîÑÎ¶¨Î∑∞ */
        .image-preview {
            position: relative;
            margin: 12px 0;
        }

        .preview-img {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 8px;
        }

        .remove-img {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Ìè¨Ïä§Ìä∏ ÌÉÄÏûÖ ÏÑ†ÌÉù */
        .post-type {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .type-btn {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dbdbdb;
            background: white;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .type-btn.active {
            background: #405de6;
            color: white;
            border-color: #405de6;
        }

        .meeting-selector {
            display: none;
            margin-bottom: 12px;
        }

        .meeting-selector.active {
            display: block;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            font-size: 14px;
        }

        /* Í≤ÄÏÉâ ÌéòÏù¥ÏßÄ */
        .search-container {
            padding: 16px;
        }

        .search-tabs {
            display: flex;
            margin-bottom: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 4px;
        }

        .search-tab {
            flex: 1;
            padding: 8px 12px;
            text-align: center;
            background: none;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-tab.active {
            background: white;
            font-weight: 600;
        }

        /* Îû≠ÌÇπ */
        .ranking-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .ranking-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 16px;
            text-align: center;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .ranking-item:last-child {
            border-bottom: none;
        }

        .rank-position {
            font-weight: bold;
            font-size: 18px;
            width: 30px;
        }

        /* ÌîÑÎ°úÌïÑ ÌéòÏù¥ÏßÄ */
        .profile-header {
            padding: 20px 16px;
            background: white;
            border-bottom: 1px solid #dbdbdb;
        }

        .profile-top {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 16px;
        }

        .profile-pic-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #405de6, #5851db, #833ab4, #c13584);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
            flex-shrink: 0;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .profile-bio {
            font-size: 14px;
            color: #8e8e8e;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .edit-profile-btn {
            background: none;
            border: 1px solid #dbdbdb;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .profile-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 16px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 18px;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: #8e8e8e;
        }

        /* Î™®Îã¨ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }

        .modal-header {
            padding: 16px;
            border-bottom: 1px solid #dbdbdb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 16px;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 16px;
        }

        .edit-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            font-size: 14px;
        }

        .form-input {
            padding: 12px;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-textarea {
            padding: 12px;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }

        .save-btn {
            background: #405de6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        /* ÎåìÍ∏Ä Ïä§ÌÉÄÏùº */
        .comment-item {
            display: flex;
            gap: 12px;
            padding: 8px 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-author {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 2px;
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 4px;
        }

        .comment-time {
            font-size: 12px;
            color: #8e8e8e;
        }

        .comment-delete {
            color: #ed4956;
            background: none;
            border: none;
            font-size: 12px;
            cursor: pointer;
            padding: 2px 4px;
        }

        /* ÏôïÎπÑÌò∏ Ìà¨Ìëú Ïä§ÌÉÄÏùº */
        .biho-vote-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .biho-vote-item:hover {
            background: #f8f9fa;
        }

        .biho-vote-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .vote-btn {
            background: #e91e63;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .vote-btn:hover {
            background: #d63447;
        }

        .vote-btn:disabled {
            background: #c7c7c7;
            cursor: not-allowed;
        }

        .biho-crown {
            font-size: 18px;
            margin-right: 8px;
        }

        /* ÏÇ≠Ï†ú Î≤ÑÌäº */
        .delete-btn {
            color: #ed4956;
            background: none;
            border: none;
            font-size: 12px;
            cursor: pointer;
            padding: 4px;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 480px) {
            .friend-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .profile-top {
                gap: 16px;
            }
            
            .profile-pic-large {
                width: 70px;
                height: 70px;
                font-size: 20px;
            }
        }

        /* Ïà®ÍπÄ ÌååÏùº ÏûÖÎ†• */
        .hidden-file-input {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <div class="logo">Í∞ÄÏ°∞Ïø†</div>
            <p style="margin-bottom: 30px; color: #8e8e8e;">ÏπúÍµ¨Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</p>
            
            <div class="friend-grid" id="friendGrid">
                <!-- ÏπúÍµ¨ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÏÉùÏÑ±Îê©ÎãàÎã§ -->
            </div>
            
            <button class="login-btn" id="loginBtn" disabled>ÏûÖÏû•ÌïòÍ∏∞</button>
        </div>
    </div>

    <!-- Î©îÏù∏ Ïï± ÌôîÎ©¥ -->
    <div id="mainApp" class="main-app">
        <!-- ÏÉùÏùº ÏïåÎ¶º Îù† -->
        <div id="birthdayBanner" class="birthday-banner"></div>

        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="header-title">Í∞ÄÏ°∞Ïø†</div>
            <div class="header-icons">
                <button class="icon-btn" onclick="showProfile()">üë§</button>
            </div>
        </div>

        <!-- Ïª®ÌÖêÏ∏† ÏòÅÏó≠ -->
        <div class="content">
            <!-- Ìôà ÌîºÎìú -->
            <div id="home" class="tab-content active">
                <!-- Ïä§ÌÜ†Î¶¨ ÏòÅÏó≠ -->
                <div class="stories-container">
                    <div class="stories-scroll" id="storiesContainer">
                        <!-- Ïä§ÌÜ†Î¶¨Í∞Ä Ïó¨Í∏∞Ïóê ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÏôïÎπÑÌò∏ Ìà¨Ìëú Î™®Îã¨ -->
    <div id="bihoVoteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üëë ÏôïÎπÑÌò∏ Ìà¨Ìëú</div>
                <button class="close-btn" onclick="closeBihoVoteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px; color: #8e8e8e; font-size: 14px;">
                    Ïù¥Î≤àÎã¨ Í∞ÄÏû• ÎßòÏóê Ïïà ÎìúÎäî ÏπúÍµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî üòà<br>
                    <span style="color: #e91e63; font-weight: bold;">Ìïú Îã¨Ïóê Ìïú Î≤àÎßå Ìà¨Ìëú Í∞ÄÎä•!</span>
                </div>
                <div id="bihoVoteList"></div>
            </div>
        </div>
    </div>

    <!-- ÌîÑÎ°úÌïÑ Ìé∏Ïßë Î™®Îã¨ -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ÌîÑÎ°úÌïÑ Ìé∏Ïßë</div>
                <button class="close-btn" onclick="closeEditProfileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="edit-form">
                    <div class="form-group">
                        <label class="form-label">Ïù¥Î¶Ñ</label>
                        <input type="text" class="form-input" id="editName" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÏûêÍ∏∞ÏÜåÍ∞ú</label>
                        <textarea class="form-textarea" id="editBio" placeholder="ÏûêÏã†ÏùÑ ÏÜåÍ∞úÌï¥Î≥¥ÏÑ∏Ïöî..."></textarea>
                    </div>
                    <button class="save-btn" onclick="saveProfile()">Ï†ÄÏû•</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase ÏÑ§Ï†ï (Ïã§Ï†ú ÏÑ§Ï†ïÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏Îê®!)
        const firebaseConfig = {
            apiKey: "AIzaSyDVGZZ6JumYWpFF82d7RW-8DHmzqzNVGoo",
            authDomain: "gazoku-91025.firebaseapp.com",
            projectId: "gazoku-91025",
            storageBucket: "gazoku-91025.firebasestorage.app",
            messagingSenderId: "295977381584",
            appId: "1:295977381584:web:f21ffb806ae7f82918b8d5"
        };

        // Firebase Ï¥àÍ∏∞Ìôî Î∞è Ïò§Î•ò Ï≤òÎ¶¨ Í∞úÏÑ†
        let db = null;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log('‚úÖ Firebase Ï¥àÍ∏∞Ìôî ÏÑ±Í≥µ!');
        } catch (error) {
            console.error('‚ùå Firebase Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
            console.log('Ïò§ÌîÑÎùºÏù∏ Î™®ÎìúÎ°ú Ïã§ÌñâÌï©ÎãàÎã§.');
        }

        // Îç∞Î™®Ïö© ÏÑ§Ï†ï Ï†úÍ±∞ Î∞è Ïã§Ï†ú Ïó∞Í≤∞ ÌôïÏù∏
        if (db) {
            console.log('üî• Firebase Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞Îê®!');
        }

        // ÏπúÍµ¨ Îç∞Ïù¥ÌÑ∞
        const friends = [
            { name: "Ìô©ÏäπÌïò", birthday: "2001-07-11" },
            { name: "Ïù¥ÏÑúÌòÑ", birthday: "2001-01-24" },
            { name: "ÌïúÌù¨Ï§Ä", birthday: "2001-12-21" },
            { name: "Î≥µÏßÄÌòÑ", birthday: "2001-01-15" },
            { name: "ÏñëÏ†ïÌõÑ", birthday: "2001-10-18" },
            { name: "Ïú§Ìù¨ÌÉú", birthday: "2001-10-15" },
            { name: "Í≥ΩÎèÑÏú§", birthday: "2001-07-31" },
            { name: "Í∞ïÏàúÍ±¥", birthday: "2001-04-18" },
            { name: "ÏñëÍ∑úÌòÑ", birthday: "2001-04-19" },
            { name: "Ïù¥ÌïôÏ§Ä", birthday: "2002-02-22" },
            { name: "Í∞ïÏ†ïÌòÑ", birthday: "2001-08-07" },
            { name: "Î∞ïÏ£ºÌò∏", birthday: "2001-06-01" },
            { name: "Ï†ÑÏÉÅÌòÅ", birthday: "2001-08-18" },
            { name: "Ïã¨Ïû¨ÌòÑ", birthday: "2001-10-05" },
            { name: "Ïã†ÎØºÌò∏", birthday: "2001-03-03" }
        ];

        let currentUser = null;
        let selectedFriend = null;
        let selectedPostType = 'diary';
        let currentImageData = null;
        let currentRankingTab = 'meeting';
        let currentPostId = null;

        // Î°úÏª¨ Ï∫êÏãú (Ïò§ÌîÑÎùºÏù∏ ÏßÄÏõêÏö©)
        let posts = [];
        let profiles = {};
        let bihoVotes = {};
        let comments = {};

        // Firebase Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ (Ïò§Î•ò Ï≤òÎ¶¨ Í∞ïÌôî)
        class FirebaseManager {
            // Í≤åÏãúÎ¨º Í¥ÄÎ†®
            static async addPost(post) {
                if (!db) {
                    console.log('Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ Ï†ÄÏû•');
                    posts.unshift(post);
                    localStorage.setItem('posts', JSON.stringify(posts));
                    return true;
                }

                try {
                    await db.collection('posts').add(post);
                    console.log('‚úÖ Í≤åÏãúÎ¨ºÏù¥ FirebaseÏóê Ï†ÄÏû•Îê®');
                    return true;
                } catch (error) {
                    console.error('Ìè¨Ïä§Ìä∏ Ï†ÄÏû• Ïã§Ìå®:', error);
                    // Î°úÏª¨ Ï†ÄÏû•ÏúºÎ°ú Ìè¥Î∞±
                    posts.unshift(post);
                    localStorage.setItem('posts', JSON.stringify(posts));
                    return true;
                }
            }

            static async getPosts() {
                if (!db) {
                    console.log('Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìú');
                    posts = JSON.parse(localStorage.getItem('posts') || '[]');
                    return posts;
                }

                try {
                    const snapshot = await db.collection('posts').orderBy('date', 'desc').get();
                    const firestorePosts = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    posts = firestorePosts;
                    console.log(`‚úÖ FirebaseÏóêÏÑú ${posts.length}Í∞ú Í≤åÏãúÎ¨º Î°úÎìúÎê®`);
                    return firestorePosts;
                } catch (error) {
                    console.error('Ìè¨Ïä§Ìä∏ Î°úÎìú Ïã§Ìå®:', error);
                    // Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î°ú Ìè¥Î∞±
                    posts = JSON.parse(localStorage.getItem('posts') || '[]');
                    return posts;
                }
            }

            static async updatePost(postId, updates) {
                if (!db) {
                    console.log('Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ ÏóÖÎç∞Ïù¥Ìä∏');
                    const postIndex = posts.findIndex(p => p.id === postId);
                    if (postIndex !== -1) {
                        posts[postIndex] = { ...posts[postIndex], ...updates };
                        localStorage.setItem('posts', JSON.stringify(posts));
                    }
                    return true;
                }

                try {
                    await db.collection('posts').doc(postId).update(updates);
                    console.log('‚úÖ Í≤åÏãúÎ¨º ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
                    return true;
                } catch (error) {
                    console.error('Ìè¨Ïä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', error);
                    // Î°úÏª¨ ÏóÖÎç∞Ïù¥Ìä∏Î°ú Ìè¥Î∞±
                    const postIndex = posts.findIndex(p => p.id === postId);
                    if (postIndex !== -1) {
                        posts[postIndex] = { ...posts[postIndex], ...updates };
                        localStorage.setItem('posts', JSON.stringify(posts));
                    }
                    return true;
                }
            }

            static async deletePost(postId) {
                if (!db) {
                    console.log('Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ ÏÇ≠Ï†ú');
                    posts = posts.filter(p => p.id !== postId);
                    localStorage.setItem('posts', JSON.stringify(posts));
                    return true;
                }

                try {
                    await db.collection('posts').doc(postId).delete();
                    console.log('‚úÖ Í≤åÏãúÎ¨º ÏÇ≠Ï†ú ÏôÑÎ£å');
                    return true;
                } catch (error) {
                    console.error('Ìè¨Ïä§Ìä∏ ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                    // Î°úÏª¨ ÏÇ≠Ï†úÎ°ú Ìè¥Î∞±
                    posts = posts.filter(p => p.id !== postId);
                    localStorage.setItem('posts', JSON.stringify(posts));
                    return true;
                }
            }

            // ÎåìÍ∏Ä Í¥ÄÎ†®
            static async addComment(postId, comment) {
                if (!db) {
                    console.log('Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ ÎåìÍ∏Ä Ï†ÄÏû•');
                    if (!comments[postId]) comments[postId] = [];
                    comments[postId].push(comment);
                    localStorage.setItem('comments', JSON.stringify(comments));
                    return true;
                }

                try {
                    await db.collection('comments').add({
                        postId: postId,
                        ...comment
                    });
                    console.log('‚úÖ ÎåìÍ∏ÄÏù¥ FirebaseÏóê Ï†ÄÏû•Îê®');
                    return true;
                } catch (error) {
                    console.error('ÎåìÍ∏Ä Ï†ÄÏû• Ïã§Ìå®:', error);
                    // Î°úÏª¨ Ï†ÄÏû•ÏúºÎ°ú Ìè¥Î∞±
                    if (!comments[postId]) comments[postId] = [];
                    comments[postId].push(comment);
                    localStorage.setItem('comments', JSON.stringify(comments));
                    return true;
                }
            }

            static async getComments() {
                if (!db) {
                    console.log('Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ ÎåìÍ∏Ä Î°úÎìú');
                    comments = JSON.parse(localStorage.getItem('comments') || '{}');
                    return comments;
                }

                try {
                    const snapshot = await db.collection('comments').get();
                    const firestoreComments = {};
                    snapshot.docs.forEach(doc => {
                        const data = doc.data();
                        if (!firestoreComments[data.postId]) {
                            firestoreComments[data.postId] = [];
                        }
                        firestoreComments[data.postId].push({
                            id: doc.id,
                            author: data.author,
                            text: data.text,
                            date: data.date
                        });
                    });
                    comments = firestoreComments;
                    console.log('‚úÖ FirebaseÏóêÏÑú ÎåìÍ∏Ä Î°úÎìúÎê®');
                    return firestoreComments;
                } catch (error) {
                    console.error('ÎåìÍ∏Ä Î°úÎìú Ïã§Ìå®:', error);
                    comments = JSON.parse(localStorage.getItem('comments') || '{}');
                    return comments;
                }
            }

            // ÏôïÎπÑÌò∏ Ìà¨Ìëú Í¥ÄÎ†®
            static async updateBihoVotes(monthKey, voteData) {
                if (!db) {
                    console.log('Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ Ìà¨Ìëú Ï†ÄÏû•');
                    bihoVotes[monthKey] = voteData;
                    localStorage.setItem('bihoVotes', JSON.stringify(bihoVotes));
                    return true;
                }

                try {
                    await db.collection('bihoVotes').doc(monthKey).set(voteData);
                    console.log('‚úÖ ÏôïÎπÑÌò∏ Ìà¨ÌëúÍ∞Ä FirebaseÏóê Ï†ÄÏû•Îê®');
                    return true;
                } catch (error) {
                    console.error('ÏôïÎπÑÌò∏ Ìà¨Ìëú Ï†ÄÏû• Ïã§Ìå®:', error);
                    // Î°úÏª¨ Ï†ÄÏû•ÏúºÎ°ú Ìè¥Î∞±
                    bihoVotes[monthKey] = voteData;
                    localStorage.setItem('bihoVotes', JSON.stringify(bihoVotes));
                    return true;
                }
            }

            static async getBihoVotes() {
                if (!db) {
                    console.log('Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ Ìà¨Ìëú Î°úÎìú');
                    bihoVotes = JSON.parse(localStorage.getItem('bihoVotes') || '{}');
                    return bihoVotes;
                }

                try {
                    const snapshot = await db.collection('bihoVotes').get();
                    const firestoreBihoVotes = {};
                    snapshot.docs.forEach(doc => {
                        firestoreBihoVotes[doc.id] = doc.data();
                    });
                    bihoVotes = firestoreBihoVotes;
                    console.log('‚úÖ FirebaseÏóêÏÑú ÏôïÎπÑÌò∏ Ìà¨Ìëú Î°úÎìúÎê®');
                    return firestoreBihoVotes;
                } catch (error) {
                    console.error('ÏôïÎπÑÌò∏ Ìà¨Ìëú Î°úÎìú Ïã§Ìå®:', error);
                    bihoVotes = JSON.parse(localStorage.getItem('bihoVotes') || '{}');
                    return bihoVotes;
                }
            }

            // ÌîÑÎ°úÌïÑ Í¥ÄÎ†®
            static async updateProfile(userId, profileData) {
                if (!db) {
                    console.log('Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ ÌîÑÎ°úÌïÑ Ï†ÄÏû•');
                    profiles[userId] = profileData;
                    localStorage.setItem('profiles', JSON.stringify(profiles));
                    return true;
                }

                try {
                    await db.collection('profiles').doc(userId).set(profileData);
                    console.log('‚úÖ ÌîÑÎ°úÌïÑÏù¥ FirebaseÏóê Ï†ÄÏû•Îê®');
                    return true;
                } catch (error) {
                    console.error('ÌîÑÎ°úÌïÑ Ï†ÄÏû• Ïã§Ìå®:', error);
                    // Î°úÏª¨ Ï†ÄÏû•ÏúºÎ°ú Ìè¥Î∞±
                    profiles[userId] = profileData;
                    localStorage.setItem('profiles', JSON.stringify(profiles));
                    return true;
                }
            }

            static async getProfiles() {
                if (!db) {
                    console.log('Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ ÌîÑÎ°úÌïÑ Î°úÎìú');
                    profiles = JSON.parse(localStorage.getItem('profiles') || '{}');
                    return profiles;
                }

                try {
                    const snapshot = await db.collection('profiles').get();
                    const firestoreProfiles = {};
                    snapshot.docs.forEach(doc => {
                        firestoreProfiles[doc.id] = doc.data();
                    });
                    profiles = firestoreProfiles;
                    console.log('‚úÖ FirebaseÏóêÏÑú ÌîÑÎ°úÌïÑ Î°úÎìúÎê®');
                    return firestoreProfiles;
                } catch (error) {
                    console.error('ÌîÑÎ°úÌïÑ Î°úÎìú Ïã§Ìå®:', error);
                    profiles = JSON.parse(localStorage.getItem('profiles') || '{}');
                    return profiles;
                }
            }
        }

        // Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        function setupRealtimeListeners() {
            if (!db) return;

            try {
                // Í≤åÏãúÎ¨º Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
                db.collection('posts').onSnapshot((snapshot) => {
                    const updatedPosts = [];
                    snapshot.docs.forEach(doc => {
                        updatedPosts.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    posts = updatedPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
                    if (document.getElementById('postFeed')) {
                        renderPostFeed();
                        renderStories();
                    }
                });

                // ÎåìÍ∏Ä Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
                db.collection('comments').onSnapshot((snapshot) => {
                    const updatedComments = {};
                    snapshot.docs.forEach(doc => {
                        const data = doc.data();
                        if (!updatedComments[data.postId]) {
                            updatedComments[data.postId] = [];
                        }
                        updatedComments[data.postId].push({
                            id: doc.id,
                            author: data.author,
                            text: data.text,
                            date: data.date
                        });
                    });
                    comments = updatedComments;
                    if (currentPostId && document.getElementById('commentModal').classList.contains('active')) {
                        renderComments(currentPostId);
                    }
                    if (document.getElementById('postFeed')) {
                        renderPostFeed();
                    }
                });

                // ÏôïÎπÑÌò∏ Ìà¨Ìëú Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
                db.collection('bihoVotes').onSnapshot((snapshot) => {
                    const updatedBihoVotes = {};
                    snapshot.docs.forEach(doc => {
                        updatedBihoVotes[doc.id] = doc.data();
                    });
                    bihoVotes = updatedBihoVotes;
                    if (currentRankingTab === 'biho' && document.getElementById('search').classList.contains('active')) {
                        renderRanking();
                    }
                });

                console.log('Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï ÏôÑÎ£å! üî•');
            } catch (error) {
                console.log('Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï Ïã§Ìå® (Ïò§ÌîÑÎùºÏù∏ Î™®Îìú):', error);
            }
        }

        // ÏôïÎπÑÌò∏ Ìà¨Ìëú Ï¥àÍ∏∞Ìôî
        async function initializeBihoVotes() {
            const now = new Date();
            const currentMonth = `${now.getFullYear()}-${now.getMonth()}`;
            
            if (!bihoVotes[currentMonth]) {
                const initialVotes = {
                    votes: {},
                    voters: {}
                };
                
                // Î™®Îì† ÏπúÍµ¨Îì§Ïóê ÎåÄÌï¥ 0ÌëúÎ°ú Ï¥àÍ∏∞Ìôî
                friends.forEach(friend => {
                    initialVotes.votes[friend.name] = 0;
                });
                
                await FirebaseManager.updateBihoVotes(currentMonth, initialVotes);
            }
        }

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            renderFriendGrid();
            setupEventListeners();
        });

        function renderFriendGrid() {
            const grid = document.getElementById('friendGrid');
            grid.innerHTML = friends.map(friend => `
                <div class="friend-card" data-name="${friend.name}" onclick="selectFriend('${friend.name}')">
                    <div class="friend-name">${friend.name}</div>
                    <div class="friend-birthday">${formatBirthday(friend.birthday)}</div>
                </div>
            `).join('');
        }

        function selectFriend(name) {
            document.querySelectorAll('.friend-card').forEach(card => {
                card.classList.remove('selected');
            });

            const selectedCard = document.querySelector(`[data-name="${name}"]`);
            selectedCard.classList.add('selected');
            selectedFriend = name;

            document.getElementById('loginBtn').disabled = false;
        }

        function setupEventListeners() {
            document.getElementById('loginBtn').addEventListener('click', login);
        }

        async function login() {
            if (!selectedFriend) return;
            
            currentUser = selectedFriend;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Î°úÎî© ÌëúÏãú
            showLoadingMessage();
            
            await initializeApp();
        }

        function showLoadingMessage() {
            const content = document.querySelector('.content');
            content.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 50vh; gap: 20px;">
                    <div style="font-size: 24px;">üî•</div>
                    <div style="font-size: 18px; font-weight: bold;">Í∞ÄÏ°∞Ïø† Î°úÎî©Ï§ë...</div>
                    <div style="font-size: 14px; color: #8e8e8e;">ÏπúÍµ¨Îì§Í≥º Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞ÌïòÎäî Ï§ëÏù¥ÏóêÏöî!</div>
                </div>
            `;
        }

        async function initializeApp() {
            try {
                // Firebase Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                await Promise.all([
                    FirebaseManager.getPosts(),
                    FirebaseManager.getComments(),
                    FirebaseManager.getBihoVotes(),
                    FirebaseManager.getProfiles()
                ]);

                // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
                setupRealtimeListeners();

                // UI Ï¥àÍ∏∞Ìôî
                setupSelectOptions();
                updateProfilePics();
                renderBirthdayBanner();
                renderStories();
                renderPostFeed();
                renderRanking();
                renderProfile();
                await initializeBihoVotes();

                console.log('‚úÖ Í∞ÄÏ°∞Ïø† Ï¥àÍ∏∞Ìôî ÏôÑÎ£å! ÏπúÍµ¨Îì§Í≥º Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞Îê® üî•');
            } catch (error) {
                console.error('Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
                // Ïò§ÌîÑÎùºÏù∏ Î™®ÎìúÎ°ú Ìè¥Î∞±
                console.log('Ïò§ÌîÑÎùºÏù∏ Î™®ÎìúÎ°ú Ïã§ÌñâÌï©ÎãàÎã§.');
            }
        }

        function setupSelectOptions() {
            const meetingSelect = document.getElementById('meetingPartner');
            const options = friends
                .filter(f => f.name !== currentUser)
                .map(f => `<option value="${f.name}">${f.name}</option>`)
                .join('');
            
            meetingSelect.innerHTML = '<option value="">ÎßåÎÇú ÏπúÍµ¨ ÏÑ†ÌÉù</option>' + options;
        }

        function updateProfilePics() {
            const initials = currentUser.substring(0, 2);
            document.getElementById('createProfilePic').textContent = initials;
            document.getElementById('profilePicLarge').textContent = initials;
            document.getElementById('profileName').textContent = currentUser;
            document.getElementById('editName').value = currentUser;
            
            // ÎåìÍ∏ÄÏö© ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            const commentProfilePic = document.getElementById('commentProfilePic');
            if (commentProfilePic) {
                commentProfilePic.textContent = initials;
            }
            
            // Ï†ÄÏû•Îêú ÌîÑÎ°úÌïÑ Ï†ïÎ≥¥ Î°úÎìú
            const userProfile = profiles[currentUser] || {};
            document.getElementById('profileBio').textContent = userProfile.bio || 'ÏïàÎÖïÌïòÏÑ∏Ïöî! Í∞ÄÏ°∞Ïø†Ïùò ÏùºÏõêÏûÖÎãàÎã§ ‚ú®';
            document.getElementById('editBio').value = userProfile.bio || 'ÏïàÎÖïÌïòÏÑ∏Ïöî! Í∞ÄÏ°∞Ïø†Ïùò ÏùºÏõêÏûÖÎãàÎã§ ‚ú®';
        }

        function renderBirthdayBanner() {
            const nextBirthday = getNextBirthday();
            document.getElementById('birthdayBanner').innerHTML = 
                `üéÇ ${nextBirthday.name}ÎãòÏùò ÏÉùÏùºÍπåÏßÄ ${nextBirthday.daysUntil}Ïùº ÎÇ®ÏïòÏñ¥Ïöî!`;
        }

        function renderStories() {
            const today = new Date().toDateString();
            const todayPosts = posts.filter(post => 
                new Date(post.date).toDateString() === today
            );

            // Ïò§Îäò ÌôúÎèôÌïú ÏπúÍµ¨Îì§Ïùò Ïä§ÌÜ†Î¶¨ ÏÉùÏÑ±
            const activeUsers = [...new Set(todayPosts.map(post => post.author))];
            
            const storiesHtml = activeUsers.map(user => {
                const userPosts = todayPosts.filter(post => post.author === user);
                const hasMeeting = userPosts.some(post => post.type === 'meeting');
                const hasDiary = userPosts.some(post => post.type === 'diary');
                
                return `
                    <div class="story-item" onclick="viewStory('${user}')">
                        <div class="story-ring ${user === currentUser ? 'viewed' : ''}">
                            <div class="story-pic">${user.substring(0, 2)}</div>
                            ${hasMeeting ? '<div class="story-badge meeting">üë•</div>' : ''}
                            ${hasDiary && !hasMeeting ? '<div class="story-badge diary">üìù</div>' : ''}
                        </div>
                        <div class="story-username">${user}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('storiesContainer').innerHTML = storiesHtml;
        }

        function viewStory(userName) {
            const today = new Date().toDateString();
            const userTodayPosts = posts.filter(post => 
                post.author === userName && new Date(post.date).toDateString() === today
            );

            if (userTodayPosts.length === 0) return;

            let storyContent = `<h3>${userName}ÎãòÏùò Ïò§Îäò</h3><br>`;
            userTodayPosts.forEach(post => {
                const type = post.type === 'meeting' ? 'üë• ÎßåÎÇ®' : 'üìù ÏùºÍ∏∞';
                storyContent += `<strong>${type}</strong><br>${post.content}<br><br>`;
                if (post.partner) {
                    storyContent += `<em>@${post.partner}ÎãòÍ≥º Ìï®Íªò</em><br><br>`;
                }
            });

            document.getElementById('likesModalBody').innerHTML = storyContent;
            document.getElementById('likesModal').querySelector('.modal-title').textContent = 'Ïò§ÎäòÏùò Ïä§ÌÜ†Î¶¨';
            document.getElementById('likesModal').classList.add('active');
        }

        function switchTab(tabName) {
            // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌôúÏÑ±Ìôî
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Ïª®ÌÖêÏ∏† ÌëúÏãú
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');

            // ÌÉ≠Î≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            if (tabName === 'search') {
                renderRanking();
            } else if (tabName === 'profile') {
                renderProfile();
            } else if (tabName === 'home') {
                renderStories();
            }
        }

        function selectPostType(type) {
            selectedPostType = type;
            
            // Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');

            // ÎßåÎÇ® ÏÑ†ÌÉùÍ∏∞ ÌëúÏãú/Ïà®ÍπÄ
            const meetingSelector = document.getElementById('meetingSelector');
            if (type === 'meeting') {
                meetingSelector.classList.add('active');
                document.getElementById('postContent').placeholder = 'Ïò§Îäò ÎàÑÍµ¨ÏôÄ ÎßåÎÇ¨ÎÇòÏöî? Ïñ¥Îñ§ ÏãúÍ∞ÑÏùÑ Î≥¥ÎÇ¥ÏÖ®ÎÇòÏöî?';
            } else {
                meetingSelector.classList.remove('active');
                document.getElementById('postContent').placeholder = 'Ïò§Îäò Ïñ¥Îñ§ ÌïòÎ£®Î•º Î≥¥ÎÇ¥ÏÖ®ÎÇòÏöî?';
            }
        }

        function previewImage(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                currentImageData = e.target.result;
                document.getElementById('imagePreview').innerHTML = `
                    <div class="image-preview">
                        <img src="${currentImageData}" class="preview-img" alt="ÎØ∏Î¶¨Î≥¥Í∏∞">
                        <button class="remove-img" onclick="removeImage()">&times;</button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function removeImage() {
            currentImageData = null;
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('imageInput').value = '';
        }

        async function createPost() {
            const content = document.getElementById('postContent').value.trim();
            
            if (!content) {
                alert('ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }

            if (selectedPostType === 'meeting') {
                const partner = document.getElementById('meetingPartner').value;
                if (!partner) {
                    alert('ÎßåÎÇú ÏπúÍµ¨Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
                    return;
                }
            }

            const post = {
                id: Date.now().toString(),
                author: currentUser,
                content: content,
                type: selectedPostType,
                partner: selectedPostType === 'meeting' ? document.getElementById('meetingPartner').value : null,
                image: currentImageData,
                likes: [],
                date: new Date().toISOString()
            };

            // FirebaseÏóê Ï†ÄÏû•
            await FirebaseManager.addPost(post);

            // Ìèº Ï¥àÍ∏∞Ìôî
            document.getElementById('postContent').value = '';
            document.getElementById('meetingPartner').value = '';
            removeImage();

            console.log('‚úÖ ÏÉà Í≤åÏãúÎ¨ºÏù¥ ÏπúÍµ¨Îì§Í≥º Ïã§ÏãúÍ∞Ñ Í≥µÏú†ÎêòÏóàÏäµÎãàÎã§!');
        }

        function renderPostFeed() {
            const feed = document.getElementById('postFeed');
            
            feed.innerHTML = posts.map(post => `
                <div class="post">
                    <div class="post-header">
                        <div class="post-user">
                            <div class="profile-pic">${post.author.substring(0, 2)}</div>
                            <div class="user-info">
                                <h4>${post.author}</h4>
                                <div class="post-time">${formatTimeAgo(post.date)}</div>
                            </div>
                        </div>
                        ${post.author === currentUser ? `
                            <button class="delete-btn" onclick="deletePost('${post.id}')">ÏÇ≠Ï†ú</button>
                        ` : ''}
                    </div>
                    
                    ${post.image ? `
                        <img src="${post.image}" class="post-image" alt="Í≤åÏãúÎ¨º Ïù¥ÎØ∏ÏßÄ">
                    ` : ''}
                    
                    <div class="post-actions">
                        <button class="action-btn ${post.likes.includes(currentUser) ? 'liked' : ''}" 
                                onclick="toggleLike('${post.id}')">
                            ${post.likes.includes(currentUser) ? '‚ù§Ô∏è' : 'ü§ç'}
                        </button>
                        <button class="action-btn" onclick="openCommentModal('${post.id}')">üí¨</button>
                        <button class="action-btn" onclick="sharePost('${post.id}')">üì§</button>
                    </div>
                    
                    ${post.likes.length > 0 ? `
                        <div class="post-likes" onclick="showLikes('${post.id}')">
                            Ï¢ãÏïÑÏöî ${post.likes.length}Í∞ú
                        </div>
                    ` : ''}
                    
                    ${comments[post.id] && comments[post.id].length > 0 ? `
                        <div style="padding: 0 16px; margin-bottom: 8px;">
                            <span style="color: #8e8e8e; font-size: 14px; cursor: pointer;" onclick="openCommentModal('${post.id}')">
                                ÎåìÍ∏Ä ${comments[post.id].length}Í∞ú Î™®Îëê Î≥¥Í∏∞
                            </span>
                        </div>
                    ` : ''}
                    
                    <div class="post-content">
                        <span class="username">${post.author}</span>
                        ${post.type === 'meeting' && post.partner ? 
                            `<span style="color: #405de6;">@${post.partner}</span>ÏôÄ Ìï®Íªò ` : ''}
                        ${post.content}
                        ${post.type === 'meeting' ? ' üë•' : ' üìù'}
                    </div>
                </div>
            `).join('');
        }

        async function toggleLike(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            const likeIndex = post.likes.indexOf(currentUser);
            let updatedLikes;
            
            if (likeIndex > -1) {
                updatedLikes = post.likes.filter(user => user !== currentUser);
            } else {
                updatedLikes = [...post.likes, currentUser];
            }

            // Firebase ÏóÖÎç∞Ïù¥Ìä∏
            await FirebaseManager.updatePost(postId, { likes: updatedLikes });
        }

        async function deletePost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            if (post.author !== currentUser) {
                alert('ÏûêÏã†Ïùò Í≤åÏãúÎ¨ºÎßå ÏÇ≠Ï†úÌï† Ïàò ÏûàÏäµÎãàÎã§!');
                return;
            }

            if (confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                await FirebaseManager.deletePost(postId);
                console.log('‚úÖ Í≤åÏãúÎ¨ºÏù¥ Î™®Îì† ÏπúÍµ¨Îì§ÏóêÍ≤åÏÑú ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§!');
            }
        }

        function showLikes(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post || post.likes.length === 0) return;

            const likesHtml = post.likes.map(user => `
                <div style="display: flex; align-items: center; gap: 12px; padding: 8px 0;">
                    <div class="profile-pic">${user.substring(0, 2)}</div>
                    <div style="font-weight: 500;">${user}</div>
                </div>
            `).join('');

            document.getElementById('likesModalBody').innerHTML = likesHtml;
            document.getElementById('likesModal').querySelector('.modal-title').textContent = 'Ï¢ãÏïÑÏöî';
            document.getElementById('likesModal').classList.add('active');
        }

        function closeLikesModal() {
            document.getElementById('likesModal').classList.remove('active');
        }

        function showRankingTab(tab) {
            currentRankingTab = tab;
            
            // ÌÉ≠ ÌôúÏÑ±Ìôî
            document.querySelectorAll('.search-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="showRankingTab('${tab}')"]`).classList.add('active');
            
            renderRanking();
        }

        function renderRanking() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            let content = '';

            if (currentRankingTab === 'meeting') {
                // Ïù¥Î≤àÎã¨ ÎßåÎÇ® Îû≠ÌÇπ
                const monthlyMeetings = posts.filter(post => {
                    const postDate = new Date(post.date);
                    return post.type === 'meeting' && 
                           postDate.getMonth() === currentMonth && 
                           postDate.getFullYear() === currentYear;
                });

                const meetingCounts = {};
                friends.forEach(friend => meetingCounts[friend.name] = 0);

                monthlyMeetings.forEach(post => {
                    meetingCounts[post.author]++;
                    if (post.partner) {
                        meetingCounts[post.partner]++;
                    }
                });

                const meetingRanking = Object.entries(meetingCounts)
                    .map(([name, count]) => ({ name, count }))
                    .sort((a, b) => b.count - a.count)
                    .slice(0, 10);

                content = `
                    <div class="ranking-card">
                        <div class="ranking-title">üë• Ïù¥Î≤àÎã¨ ÎßåÎÇ®ÌÇπ Îû≠ÌÇπ</div>
                        ${meetingRanking.map((item, index) => `
                            <div class="ranking-item">
                                <span class="rank-position">${index + 1}ÏúÑ</span>
                                <span>${item.name}</span>
                                <span>${item.count}Î≤à</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (currentRankingTab === 'popular') {
                // Ïù¥Î≤àÎã¨ Ïù∏Í∏∞Í∏Ä
                const monthlyPosts = posts.filter(post => {
                    const postDate = new Date(post.date);
                    return postDate.getMonth() === currentMonth && 
                           postDate.getFullYear() === currentYear;
                });

                const popularPosts = monthlyPosts
                    .sort((a, b) => b.likes.length - a.likes.length)
                    .slice(0, 5);

                content = `
                    <div class="ranking-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="ranking-title">üî• Ïù¥Î≤àÎã¨ Ïù∏Í∏∞Í∏Ä TOP 5</div>
                        ${popularPosts.map((post, index) => `
                            <div class="ranking-item" style="flex-direction: column; align-items: stretch; padding: 12px 0;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <span class="rank-position">${index + 1}ÏúÑ</span>
                                    <span>${post.author}</span>
                                    <span>‚ù§Ô∏è ${post.likes.length}</span>
                                </div>
                                <div style="font-size: 12px; opacity: 0.8; line-height: 1.3;">
                                    ${post.content.length > 50 ? post.content.substring(0, 50) + '...' : post.content}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (currentRankingTab === 'biho') {
                // ÏôïÎπÑÌò∏ Îû≠ÌÇπ
                const now = new Date();
                const currentMonth = `${now.getFullYear()}-${now.getMonth()}`;
                
                // Ï¥àÍ∏∞ÌôîÍ∞Ä ÏïàÎêòÏñ¥ ÏûàÎã§Î©¥ ÏßÄÍ∏à Ï¥àÍ∏∞Ìôî
                if (!bihoVotes[currentMonth]) {
                    initializeBihoVotes();
                }
                
                const currentVotes = bihoVotes[currentMonth] || { votes: {}, voters: {} };
                const bihoRanking = Object.entries(currentVotes.votes || {})
                    .map(([name, votes]) => ({ name, votes }))
                    .sort((a, b) => b.votes - a.votes);

                const hasVoted = currentVotes.voters && currentVotes.voters[currentUser];

                content = `
                    <div class="ranking-card" style="background: linear-gradient(135deg, #e91e63 0%, #ad1457 100%);">
                        <div class="ranking-title">üëë Ïù¥Î≤àÎã¨ ÏôïÎπÑÌò∏ Îû≠ÌÇπ</div>
                        <div style="text-align: center; margin-bottom: 16px; font-size: 12px; opacity: 0.8;">
                            ${now.getMonth() + 1}Ïõî ÏôïÎπÑÌò∏ Ìà¨Ìëú ÌòÑÌô©
                        </div>
                        ${bihoRanking.filter(item => item.votes > 0).length === 0 ? `
                            <div style="text-align: center; padding: 20px; opacity: 0.7;">
                                ÏïÑÏßÅ Ìà¨ÌëúÍ∞Ä ÏóÜÏñ¥Ïöî<br>Ï≤´ Ìà¨ÌëúÏùò Ï£ºÏù∏Í≥µÏù¥ ÎêòÏñ¥Î≥¥ÏÑ∏Ïöî! üòà
                            </div>
                        ` : bihoRanking.filter(item => item.votes > 0).map((item, index) => `
                            <div class="ranking-item">
                                <div style="display: flex; align-items: center;">
                                    <span class="rank-position">${index + 1}ÏúÑ</span>
                                    ${index === 0 ? '<span class="biho-crown">üëë</span>' : ''}
                                    <span>${item.name}</span>
                                </div>
                                <span>${item.votes}Ìëú</span>
                            </div>
                        `).join('')}
                        
                        <div style="text-align: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.2);">
                            ${hasVoted ? 
                                '<span style="font-size: 12px; opacity: 0.7;">Ïù¥Î≤àÎã¨ Ìà¨Ìëú ÏôÑÎ£å! üëç</span>' : 
                                '<button class="vote-btn" onclick="openBihoVoteModal()">Ìà¨ÌëúÌïòÎü¨ Í∞ÄÍ∏∞</button>'
                            }
                        </div>
                    </div>
                `;
            } else if (currentRankingTab === 'stats') {
                // Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ
                const totalPosts = posts.length;
                const totalMeetings = posts.filter(p => p.type === 'meeting').length;
                const totalLikes = posts.reduce((sum, p) => sum + p.likes.length, 0);
                const mostActiveUser = friends.reduce((max, friend) => {
                    const friendPosts = posts.filter(p => p.author === friend.name).length;
                    return friendPosts > max.count ? { name: friend.name, count: friendPosts } : max;
                }, { name: '', count: 0 });

                content = `
                    <div class="ranking-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="ranking-title">üìä Í∞ÄÏ°∞Ïø† Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ</div>
                        <div class="ranking-item">
                            <span>Ï¥ù Í≤åÏãúÎ¨º</span>
                            <span>${totalPosts}Í∞ú</span>
                        </div>
                        <div class="ranking-item">
                            <span>Ï¥ù ÎßåÎÇ®</span>
                            <span>${totalMeetings}Î≤à</span>
                        </div>
                        <div class="ranking-item">
                            <span>Ï¥ù Ï¢ãÏïÑÏöî</span>
                            <span>${totalLikes}Í∞ú</span>
                        </div>
                        <div class="ranking-item">
                            <span>ÏµúÍ≥† ÌôúÎèôÎü¨</span>
                            <span>${mostActiveUser.name} (${mostActiveUser.count}Í∞ú)</span>
                        </div>
                    </div>
                `;
            }

            document.getElementById('rankingContent').innerHTML = content;
        }

        function renderProfile() {
            const userPosts = posts.filter(post => post.author === currentUser);
            const userMeetings = posts.filter(post => 
                post.type === 'meeting' && (post.author === currentUser || post.partner === currentUser)
            );
            const userLikes = posts.reduce((total, post) => {
                return total + (post.author === currentUser ? post.likes.length : 0);
            }, 0);

            document.getElementById('postCount').textContent = userPosts.length;
            document.getElementById('meetingCount').textContent = userMeetings.length;
            document.getElementById('likeCount').textContent = userLikes;

            // ÎÇ¥ Í≤åÏãúÎ¨º ÌëúÏãú
            document.getElementById('myPosts').innerHTML = `
                <div style="padding: 16px;">
                    <h3 style="margin-bottom: 16px; text-align: center;">ÎÇ¥ Í≤åÏãúÎ¨º</h3>
                    ${userPosts.length === 0 ? `
                        <div style="text-align: center; color: #8e8e8e; margin: 40px 0;">
                            ÏïÑÏßÅ Í≤åÏãúÎ¨ºÏù¥ ÏóÜÏñ¥Ïöî<br>
                            Ï≤´ Î≤àÏß∏ Í≤åÏãúÎ¨ºÏùÑ ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!
                        </div>
                    ` : userPosts.map(post => `
                        <div class="post" style="margin-bottom: 16px;">
                            <div class="post-header">
                                <div class="post-user">
                                    <div class="profile-pic">${post.author.substring(0, 2)}</div>
                                    <div class="user-info">
                                        <h4>${post.author}</h4>
                                        <div class="post-time">${formatTimeAgo(post.date)}</div>
                                    </div>
                                </div>
                                <button class="delete-btn" onclick="deletePost('${post.id}')">ÏÇ≠Ï†ú</button>
                            </div>
                            
                            ${post.image ? `
                                <img src="${post.image}" class="post-image" alt="Í≤åÏãúÎ¨º Ïù¥ÎØ∏ÏßÄ">
                            ` : ''}
                            
                            <div class="post-actions">
                                <button class="action-btn ${post.likes.includes(currentUser) ? 'liked' : ''}" 
                                        onclick="toggleLike('${post.id}')">
                                    ${post.likes.includes(currentUser) ? '‚ù§Ô∏è' : 'ü§ç'}
                                </button>
                            </div>
                            
                            ${post.likes.length > 0 ? `
                                <div class="post-likes" onclick="showLikes('${post.id}')">
                                    Ï¢ãÏïÑÏöî ${post.likes.length}Í∞ú
                                </div>
                            ` : ''}
                            
                            <div class="post-content">
                                <span class="username">${post.author}</span>
                                ${post.type === 'meeting' && post.partner ? 
                                    `<span style="color: #405de6;">@${post.partner}</span>ÏôÄ Ìï®Íªò ` : ''}
                                ${post.content}
                                ${post.type === 'meeting' ? ' üë•' : ' üìù'}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ÎåìÍ∏Ä Í∏∞Îä•
        function openCommentModal(postId) {
            currentPostId = postId;
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            renderComments(postId);
            document.getElementById('commentModal').classList.add('active');
            
            // ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('commentProfilePic').textContent = currentUser.substring(0, 2);
        }

        function closeCommentModal() {
            document.getElementById('commentModal').classList.remove('active');
            document.getElementById('commentInput').value = '';
            currentPostId = null;
        }

        function renderComments(postId) {
            const postComments = comments[postId] || [];
            const commentsHtml = postComments.map(comment => `
                <div class="comment-item">
                    <div class="profile-pic">${comment.author.substring(0, 2)}</div>
                    <div class="comment-content">
                        <div class="comment-author">${comment.author}</div>
                        <div class="comment-text">${comment.text}</div>
                        <div class="comment-time">${formatTimeAgo(comment.date)}</div>
                    </div>
                    ${comment.author === currentUser ? `
                        <button class="comment-delete" onclick="deleteComment('${postId}', '${comment.id}')">ÏÇ≠Ï†ú</button>
                    ` : ''}
                </div>
            `).join('');

            document.getElementById('commentsList').innerHTML = postComments.length === 0 ? 
                '<div style="text-align: center; color: #8e8e8e; padding: 20px;">Ï≤´ Î≤àÏß∏ ÎåìÍ∏ÄÏùÑ ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî!</div>' : 
                commentsHtml;
        }

        async function addComment() {
            if (!currentPostId) return;
            
            const commentText = document.getElementById('commentInput').value.trim();
            if (!commentText) return;

            const comment = {
                id: Date.now().toString(),
                author: currentUser,
                text: commentText,
                date: new Date().toISOString()
            };

            // FirebaseÏóê Ï†ÄÏû•
            await FirebaseManager.addComment(currentPostId, comment);

            document.getElementById('commentInput').value = '';
            console.log('‚úÖ ÎåìÍ∏ÄÏù¥ ÏπúÍµ¨Îì§Í≥º Ïã§ÏãúÍ∞Ñ Í≥µÏú†ÎêòÏóàÏäµÎãàÎã§!');
        }

        async function deleteComment(postId, commentId) {
            try {
                await db.collection('comments').doc(commentId).delete();
                console.log('‚úÖ ÎåìÍ∏ÄÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§!');
            } catch (error) {
                console.error('ÎåìÍ∏Ä ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                // Î°úÏª¨ ÏÇ≠Ï†úÎ°ú Ìè¥Î∞±
                if (comments[postId]) {
                    comments[postId] = comments[postId].filter(c => c.id !== commentId);
                    localStorage.setItem('comments', JSON.stringify(comments));
                    renderComments(postId);
                    renderPostFeed();
                }
            }
        }

        function handleCommentKeyPress(event) {
            if (event.key === 'Enter') {
                addComment();
            }
        }

        function sharePost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            const shareText = `${post.author}ÎãòÏùò Í≤åÏãúÎ¨ºÏùÑ ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî!\n\n"${post.content.substring(0, 100)}${post.content.length > 100 ? '...' : ''}"`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Í∞ÄÏ°∞Ïø† Í≤åÏãúÎ¨º',
                    text: shareText
                });
            } else {
                // ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Í≤åÏãúÎ¨º ÎÇ¥Ïö©Ïù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                }).catch(() => {
                    alert('Í≥µÏú†ÌïòÍ∏∞: ' + shareText);
                });
            }
        }

        // ÏôïÎπÑÌò∏ Ìà¨Ìëú Ìï®ÏàòÎì§
        function openBihoVoteModal() {
            const now = new Date();
            const currentMonth = `${now.getFullYear()}-${now.getMonth()}`;
            const currentVotes = bihoVotes[currentMonth] || { votes: {}, voters: {} };
            
            // Ïù¥ÎØ∏ Ìà¨ÌëúÌñàÎäîÏßÄ ÌôïÏù∏
            if (currentVotes.voters && currentVotes.voters[currentUser]) {
                alert('Ïù¥Î≤àÎã¨Ïóê Ïù¥ÎØ∏ Ìà¨ÌëúÌïòÏÖ®ÏäµÎãàÎã§! Îã§ÏùåÎã¨ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî üòä');
                return;
            }

            // Ìà¨Ìëú Í∞ÄÎä•Ìïú ÏπúÍµ¨Îì§ (ÏûêÏã† Ï†úÏô∏)
            const votableFriends = friends.filter(f => f.name !== currentUser);
            
            const voteListHtml = votableFriends.map(friend => `
                <div class="biho-vote-item">
                    <div class="biho-vote-info">
                        <div class="profile-pic">${friend.name.substring(0, 2)}</div>
                        <div>
                            <div style="font-weight: 600;">${friend.name}</div>
                            <div style="font-size: 12px; color: #8e8e8e;">ÌòÑÏû¨ ${currentVotes.votes[friend.name] || 0}Ìëú</div>
                        </div>
                    </div>
                    <button class="vote-btn" onclick="voteBiho('${friend.name}')">Ìà¨Ìëú</button>
                </div>
            `).join('');

            document.getElementById('bihoVoteList').innerHTML = voteListHtml;
            document.getElementById('bihoVoteModal').classList.add('active');
        }

        function closeBihoVoteModal() {
            document.getElementById('bihoVoteModal').classList.remove('active');
        }

        async function voteBiho(targetName) {
            if (confirm(`Ï†ïÎßê ${targetName}ÎãòÏóêÍ≤å Ìà¨ÌëúÌïòÏãúÍ≤†ÏäµÎãàÍπå? üòà\nÏù¥Î≤àÎã¨ÏóêÎäî Îã§Ïãú Ìà¨ÌëúÌï† Ïàò ÏóÜÏñ¥Ïöî!`)) {
                const now = new Date();
                const currentMonth = `${now.getFullYear()}-${now.getMonth()}`;
                
                if (!bihoVotes[currentMonth]) {
                    await initializeBihoVotes();
                }
                
                const currentVotes = { ...bihoVotes[currentMonth] };
                currentVotes.votes[targetName]++;
                currentVotes.voters[currentUser] = true;
                
                // Firebase ÏóÖÎç∞Ïù¥Ìä∏
                await FirebaseManager.updateBihoVotes(currentMonth, currentVotes);
                
                closeBihoVoteModal();
                
                alert(`${targetName}ÎãòÏóêÍ≤å Ìà¨Ìëú ÏôÑÎ£å! üëë\nÍ≤∞Í≥ºÎäî Îû≠ÌÇπÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî!`);
                console.log('‚úÖ ÏôïÎπÑÌò∏ Ìà¨ÌëúÍ∞Ä ÏπúÍµ¨Îì§Í≥º Ïã§ÏãúÍ∞Ñ Í≥µÏú†ÎêòÏóàÏäµÎãàÎã§!');
            }
        }

        function openCreateModal() {
            // Ìè¨Ïä§Ìä∏ ÏûëÏÑ± ÏòÅÏó≠ÏúºÎ°ú Ïä§ÌÅ¨Î°§
            switchTab('home');
            setTimeout(() => {
                document.querySelector('.create-post').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'center'
                });
                document.getElementById('postContent').focus();
            }, 100);
        }

        function showProfile() {
            switchTab('profile');
        }

        function openEditProfileModal() {
            document.getElementById('editProfileModal').classList.add('active');
        }

        function closeEditProfileModal() {
            document.getElementById('editProfileModal').classList.remove('active');
        }

        async function saveProfile() {
            const bio = document.getElementById('editBio').value.trim();
            
            const profileData = {
                bio: bio || 'ÏïàÎÖïÌïòÏÑ∏Ïöî! Í∞ÄÏ°∞Ïø†Ïùò ÏùºÏõêÏûÖÎãàÎã§ ‚ú®'
            };
            
            // FirebaseÏóê Ï†ÄÏû•
            await FirebaseManager.updateProfile(currentUser, profileData);
            
            document.getElementById('profileBio').textContent = profileData.bio;
            closeEditProfileModal();
            
            console.log('‚úÖ ÌîÑÎ°úÌïÑÏù¥ ÏπúÍµ¨Îì§Í≥º Ïã§ÏãúÍ∞Ñ Í≥µÏú†ÎêòÏóàÏäµÎãàÎã§!');
        }

        // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
        function formatBirthday(birthday) {
            const date = new Date(birthday);
            return `${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
        }

        function getDaysUntilBirthday(birthday) {
            const today = new Date();
            const birthDate = new Date(birthday);
            birthDate.setFullYear(today.getFullYear());
            
            if (birthDate < today) {
                birthDate.setFullYear(today.getFullYear() + 1);
            }
            
            const diffTime = birthDate - today;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function getNextBirthday() {
            return friends
                .map(friend => ({
                    ...friend,
                    daysUntil: getDaysUntilBirthday(friend.birthday)
                }))
                .sort((a, b) => a.daysUntil - b.daysUntil)[0];
        }

        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = now - date;
            const diffMinutes = Math.floor(diffTime / (1000 * 60));
            const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffMinutes < 1) {
                return 'Î∞©Í∏à Ï†Ñ';
            } else if (diffMinutes < 60) {
                return `${diffMinutes}Î∂Ñ Ï†Ñ`;
            } else if (diffHours < 24) {
                return `${diffHours}ÏãúÍ∞Ñ Ï†Ñ`;
            } else if (diffDays === 1) {
                return 'Ïñ¥Ï†ú';
            } else if (diffDays < 7) {
                return `${diffDays}Ïùº Ï†Ñ`;
            } else {
                return `${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
            }
        }

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });

        // ÌÇ§Î≥¥Îìú ESCÎ°ú Î™®Îã¨ Îã´Í∏∞
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });
    </script>
</body>
</html>

                <!-- Ìè¨Ïä§Ìä∏ ÏûëÏÑ± -->
                <div class="create-post">
                    <div class="create-header">
                        <div class="profile-pic" id="createProfilePic"></div>
                        <div style="flex: 1;">
                            <div class="post-type">
                                <button class="type-btn active" data-type="diary" onclick="selectPostType('diary')">üìù ÏùºÍ∏∞</button>
                                <button class="type-btn" data-type="meeting" onclick="selectPostType('meeting')">üë• ÎßåÎÇ®</button>
                            </div>
                        </div>
                    </div>
                    
                    <textarea class="create-input" id="postContent" placeholder="Ïò§Îäò Ïñ¥Îñ§ ÌïòÎ£®Î•º Î≥¥ÎÇ¥ÏÖ®ÎÇòÏöî?"></textarea>
                    
                    <div class="meeting-selector" id="meetingSelector">
                        <select id="meetingPartner">
                            <option value="">ÎßåÎÇú ÏπúÍµ¨ ÏÑ†ÌÉù</option>
                        </select>
                    </div>
                    
                    <div id="imagePreview"></div>
                    
                    <div class="create-actions">
                        <button class="attach-btn" onclick="document.getElementById('imageInput').click()">
                            üì∑ ÏÇ¨ÏßÑ Ï≤®Î∂Ä
                        </button>
                        <button class="post-btn" onclick="createPost()">Í≤åÏãú</button>
                    </div>
                    
                    <input type="file" id="imageInput" class="hidden-file-input" accept="image/*" onchange="previewImage(this)">
                </div>

                <!-- Ìè¨Ïä§Ìä∏ ÌîºÎìú -->
                <div id="postFeed"></div>
            </div>

            <!-- Í≤ÄÏÉâ/Îû≠ÌÇπ ÌÉ≠ -->
            <div id="search" class="tab-content">
                <div class="search-container">
                    <div class="search-tabs">
                        <button class="search-tab active" onclick="showRankingTab('meeting')">ÎßåÎÇ®ÌÇπ</button>
                        <button class="search-tab" onclick="showRankingTab('popular')">Ïù∏Í∏∞Í∏Ä</button>
                        <button class="search-tab" onclick="showRankingTab('biho')">ÏôïÎπÑÌò∏</button>
                        <button class="search-tab" onclick="showRankingTab('stats')">ÌÜµÍ≥Ñ</button>
                    </div>
                    <div id="rankingContent"></div>
                </div>
            </div>

            <!-- ÌîÑÎ°úÌïÑ ÌÉ≠ -->
            <div id="profile" class="tab-content">
                <div class="profile-header">
                    <div class="profile-top">
                        <div class="profile-pic-large" id="profilePicLarge"></div>
                        <div class="profile-info">
                            <div class="profile-name" id="profileName"></div>
                            <div class="profile-bio" id="profileBio">ÏïàÎÖïÌïòÏÑ∏Ïöî! Í∞ÄÏ°∞Ïø†Ïùò ÏùºÏõêÏûÖÎãàÎã§ ‚ú®</div>
                            <button class="edit-profile-btn" onclick="openEditProfileModal()">ÌîÑÎ°úÌïÑ Ìé∏Ïßë</button>
                        </div>
                    </div>
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="postCount">0</span>
                            <span class="stat-label">Í≤åÏãúÎ¨º</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="meetingCount">0</span>
                            <span class="stat-label">ÎßåÎÇ®</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="likeCount">0</span>
                            <span class="stat-label">Ï¢ãÏïÑÏöî</span>
                        </div>
                    </div>
                </div>
                <div id="myPosts"></div>
            </div>
        </div>

        <!-- ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <div class="bottom-nav">
            <div class="nav-item active" data-tab="home" onclick="switchTab('home')">üè†</div>
            <div class="nav-item" data-tab="search" onclick="switchTab('search')">üîç</div>
            <div class="nav-item" data-tab="profile" onclick="switchTab('profile')">üë§</div>
        </div>
    </div>

    <!-- Ï¢ãÏïÑÏöî Î™©Î°ù Î™®Îã¨ -->
    <div id="likesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ï¢ãÏïÑÏöî</div>
                <button class="close-btn" onclick="closeLikesModal()">&times;</button>
            </div>
            <div class="modal-body" id="likesModalBody"></div>
        </div>
    </div>

    <!-- ÎåìÍ∏Ä Î™®Îã¨ -->
    <div id="commentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ÎåìÍ∏Ä</div>
                <button class="close-btn" onclick="closeCommentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="commentsList"></div>
                <div style="border-top: 1px solid #dbdbdb; padding: 16px; margin-top: 16px;">
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <div class="profile-pic" id="commentProfilePic"></div>
                        <input type="text" id="commentInput" placeholder="ÎåìÍ∏Ä Îã¨Í∏∞..." 
                               style="flex: 1; border: none; outline: none; font-size: 14px;"
                               onkeypress="handleCommentKeyPress(event)">
                        <button onclick="addComment()" style="background: #405de6; color: white; border: none; border-radius: 4px; padding: 6px 12px; font-size: 12px; cursor: pointer;">Í≤åÏãú</button>
                    </div>
                </div>
